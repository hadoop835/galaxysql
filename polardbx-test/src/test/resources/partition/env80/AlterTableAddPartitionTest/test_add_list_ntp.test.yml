## DISABLE_FAST_SQL_PARSER
#########
## l_h_ntp
drop table if exists l_h_ntp1;
drop table if exists l_h_ntp2;
create table if not exists l_h_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by hash (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) subpartitions 2,
partition p2 values in ( to_days('2021-11-01') ) subpartitions 2,
partition p3 values in ( to_days('2040-01-01') ) subpartitions 3
);
create table if not exists l_h_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by hash (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) subpartitions 2,
partition p2 values in ( to_days('2021-11-01') ) subpartitions 2,
partition p3 values in ( to_days('2040-01-01') ) subpartitions 3);

insert into l_h_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into l_h_ntp1 values (1,2,'2021-11-01','abc','abc');
insert into l_h_ntp1 values (1,2,'2040-01-01','abc','abc');
alter table l_h_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) subpartitions 3);
alter table l_h_ntp1 add partition (partition p5 values in(to_days('2060-01-01')) subpartitions 2);
insert into l_h_ntp1 values (2,2,'2020-01-01','abc','abc');
insert into l_h_ntp1 values (2,2,'2021-11-01','abc','abc');
insert into l_h_ntp1 values (2,2,'2040-01-01','abc','abc');
insert into l_h_ntp1 values (2,2,'2050-01-01','abc','abc');
insert into l_h_ntp1 values (2,2,'2060-01-01','abc','abc');
insert into l_h_ntp2 values (10,2,'2020-01-01','abc','abc');
insert into l_h_ntp2 values (10,2,'2021-11-01','abc','abc');
insert into l_h_ntp2 values (10,2,'2040-01-01','abc','abc');
alter table l_h_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) subpartitions 3);
alter table l_h_ntp2 add partition (partition p5 values in(to_days('2060-01-01')) subpartitions 2);
insert into l_h_ntp2 values (20,2,'2020-01-01','abc','abc');
insert into l_h_ntp2 values (20,2,'2021-11-01','abc','abc');
insert into l_h_ntp2 values (20,2,'2040-01-01','abc','abc');
insert into l_h_ntp2 values (20,2,'2050-01-01','abc','abc');
insert into l_h_ntp2 values (20,2,'2060-01-01','abc','abc');
show full create table l_h_ntp1;
show full create table l_h_ntp2;
select * from l_h_ntp1 order by a,b,c,d,e;
select * from l_h_ntp2 order by a,b,c,d,e;
  
  ## l_k_ntp
drop table if exists l_k_ntp1;
drop table if exists l_k_ntp2;
create table if not exists l_k_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by key (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) subpartitions 2,
partition p2 values in ( to_days('2021-11-01') ) subpartitions 2,
partition p3 values in ( to_days('2040-01-01') ) subpartitions 3);

create table if not exists l_k_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by key (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) subpartitions 2,
partition p2 values in ( to_days('2021-11-01') ) subpartitions 2,
partition p3 values in ( to_days('2040-01-01') ) subpartitions 3);

insert into l_k_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into l_k_ntp1 values (1,2,'2021-11-01','abc','abc');
insert into l_k_ntp1 values (1,2,'2040-01-01','abc','abc');
alter table l_k_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) subpartitions 5);
insert into l_k_ntp1 values (2,2,'2020-01-01','abc','abc');
insert into l_k_ntp1 values (2,2,'2021-11-01','abc','abc');
insert into l_k_ntp1 values (2,2,'2050-01-01','abc','abc');
insert into l_k_ntp2 values (10,2,'2020-01-01','abc','abc');
insert into l_k_ntp2 values (10,2,'2021-11-01','abc','abc');
insert into l_k_ntp2 values (10,2,'2040-01-01','abc','abc');
alter table l_k_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) subpartitions 5);
alter table l_k_ntp2 add partition (partition p5 values in(to_days('2060-01-01')) subpartitions 2);
insert into l_k_ntp2 values (100,2,'2020-01-01','abc','abc');
insert into l_k_ntp2 values (100,2,'2021-11-01','abc','abc');
insert into l_k_ntp2 values (100,2,'2040-01-01','abc','abc');
insert into l_k_ntp2 values (100,2,'2050-01-01','abc','abc');
insert into l_k_ntp2 values (100,2,'2060-01-01','abc','abc');

show full create table l_k_ntp1;
show full create table l_k_ntp2;
select * from l_k_ntp1 order by a,b,c,d,e;
select * from l_k_ntp2 order by a,b,c,d,e;
  
  ## l_r_ntp
drop table if exists l_r_ntp1;
drop table if exists l_r_ntp2;
create table if not exists l_r_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range (a)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values less than ( 1000),
subpartition p1sp2 values less than ( 200000 )
),
partition p2 values in ( to_days('2023-01-01') ) (
subpartition p2sp1 values less than ( 1000),
subpartition p2sp2 values less than ( 200000 )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values less than ( 1000),
subpartition p3sp2 values less than ( 2000),
subpartition p3sp3 values less than ( 200000 )
)
);
create table if not exists l_r_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range (a)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values less than ( 1000),
subpartition p1sp2 values less than ( 200000 )
),
partition p2 values in ( to_days('2023-01-01') ) (
subpartition p2sp1 values less than ( 1000),
subpartition p2sp2 values less than ( 200000 )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values less than ( 1000),
subpartition p3sp2 values less than ( 2000),
subpartition p3sp3 values less than ( 200000 )
)
);
insert into l_r_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into l_r_ntp1 values (1000,2,'2023-01-01','abc','abc');
insert into l_r_ntp1 values (2000,2,'2040-01-01','abc','abc');
alter table l_r_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values less than ( 200000)));
insert into l_r_ntp1 values (2,2,'2020-01-01','abc','abc');
insert into l_r_ntp1 values (1000,2,'2023-01-01','abc','abc');
insert into l_r_ntp1 values (2000,2,'2040-01-01','abc','abc');
insert into l_r_ntp1 values (5000,2,'2050-01-01','abc','abc');
insert into l_r_ntp2 values (1,2,'2020-01-01','abc','abc');
insert into l_r_ntp2 values (1000,2,'2023-01-01','abc','abc');
insert into l_r_ntp2 values (2000,2,'2040-01-01','abc','abc');
alter table l_r_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values less than ( 200000)));
insert into l_r_ntp2 values (2,2,'2020-01-01','abc','abc');
insert into l_r_ntp2 values (1000,2,'2023-01-01','abc','abc');
insert into l_r_ntp2 values (2000,2,'2040-01-01','abc','abc');
insert into l_r_ntp2 values (5000,2,'2050-01-01','abc','abc');
alter table l_r_ntp1 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000));
insert into l_r_ntp1 values (10000,2,'2023-01-01','abc','abc');
insert into l_r_ntp1 values (100000,20,'2023-01-01','abc','abc');
insert into l_r_ntp1 values (200000,200,'2023-01-01','abc','abc');
insert into l_r_ntp1 values (400000,2000,'2023-01-01','abc','abc');
alter table l_r_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000));
insert into l_r_ntp1 values (100000,30,'2050-01-01','abc','abc');
insert into l_r_ntp1 values (200000,300,'2050-01-01','abc','abc');
insert into l_r_ntp1 values (400000,3000,'2050-01-01','abc','abc');

alter table l_r_ntp2 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000));
insert into l_r_ntp2 values (10000,2,'2023-01-01','abc','abc');
insert into l_r_ntp2 values (100000,20,'2023-01-01','abc','abc');
insert into l_r_ntp2 values (200000,200,'2023-01-01','abc','abc');
insert into l_r_ntp2 values (400000,2000,'2023-01-01','abc','abc');
alter table l_r_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000));
insert into l_r_ntp2 values (100000,30,'2050-01-01','abc','abc');
insert into l_r_ntp2 values (200000,300,'2050-01-01','abc','abc');
insert into l_r_ntp2 values (400000,3000,'2050-01-01','abc','abc');

show full create table l_r_ntp1;
show full create table l_r_ntp2;
select * from l_r_ntp1 order by a,b,c,d,e;
select * from l_r_ntp2 order by a,b,c,d,e;
  
  ## l_rc_ntp
drop table if exists l_rc_ntp1;
drop table if exists l_rc_ntp2;
create table if not exists l_rc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range columns (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values less than ( 1000, 10000),
subpartition p1sp2 values less than ( 200000, 200000 )
),
partition p2 values in ( to_days('2024-01-01') ) (
subpartition p2sp1 values less than ( 1000, 10000),
subpartition p2sp2 values less than ( 200000, 200000 )
),
partition p3 values in ( to_days('2040-01-01')  ) (
subpartition p3sp1 values less than ( 1000, 10000),
subpartition p3sp2 values less than ( 2000, 10000),
subpartition p3sp3 values less than ( 200000, 200000 )
)
);
create table if not exists l_rc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range columns (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values less than ( 1000, 10000),
subpartition p1sp2 values less than ( 200000, 200000 )
),
partition p2 values in ( to_days('2024-01-01') ) (
subpartition p2sp1 values less than ( 1000, 10000),
subpartition p2sp2 values less than ( 200000, 200000 )
),
partition p3 values in ( to_days('2040-01-01')  ) (
subpartition p3sp1 values less than ( 1000, 10000),
subpartition p3sp2 values less than ( 2000, 10000),
subpartition p3sp3 values less than ( 200000, 200000 )
)
);
insert into l_rc_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into l_rc_ntp1 values (1000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp1 values (2000,2,'2040-01-01','abc','abc');
alter table l_rc_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values less than ( 200000, 200000)));
insert into l_rc_ntp1 values (2,2,'2020-01-01','abc','abc');
insert into l_rc_ntp1 values (1000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp1 values (2000,2,'2040-01-01','abc','abc');
insert into l_rc_ntp1 values (2000,2,'2050-01-01','abc','abc');
insert into l_rc_ntp2 values (1,2,'2020-01-01','abc','abc');
insert into l_rc_ntp2 values (1000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (2000,2,'2040-01-01','abc','abc');
alter table l_rc_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4spx values less than ( 200000, 200000)));
alter table l_rc_ntp2 drop subpartition p4spx;
alter table l_rc_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values less than ( 200000, 200000)));

insert into l_rc_ntp2 values (2,2,'2020-01-01','abc','abc');
insert into l_rc_ntp2 values (1000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (2000,2,'2040-01-01','abc','abc');
alter table l_rc_ntp2 drop subpartition p2sp1,p3sp2;
insert into l_rc_ntp2 values (3,2,'2020-01-01','abc','abc');
insert into l_rc_ntp2 values (1000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (2000,2,'2040-01-01','abc','abc');
alter table l_rc_ntp2 drop partition p3;
insert into l_rc_ntp2 values (1000,2,'2024-01-01','abc','abc');

alter table l_rc_ntp1 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000,500000));
insert into l_rc_ntp1 values (10000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp1 values (100000,20,'2024-01-01','abc','abc');
insert into l_rc_ntp1 values (200000,200,'2024-01-01','abc','abc');
insert into l_rc_ntp1 values (400000,2000,'2024-01-01','abc','abc');
alter table l_rc_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000,500000));
insert into l_rc_ntp1 values (100000,30,'2050-01-01','abc','abc');
insert into l_rc_ntp1 values (200000,300,'2050-01-01','abc','abc');
insert into l_rc_ntp1 values (400000,3000,'2050-01-01','abc','abc');

alter table l_rc_ntp2 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000,500000));
insert into l_rc_ntp2 values (10000,2,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (100000,20,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (200000,200,'2024-01-01','abc','abc');
insert into l_rc_ntp2 values (400000,2000,'2024-01-01','abc','abc');
alter table l_rc_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000,500000));
insert into l_rc_ntp2 values (100000,30,'2050-01-01','abc','abc');
insert into l_rc_ntp2 values (200000,300,'2050-01-01','abc','abc');
insert into l_rc_ntp2 values (400000,3000,'2050-01-01','abc','abc');

show full create table l_rc_ntp1;
show full create table l_rc_ntp2;
select * from l_rc_ntp1 order by a,b,c,d,e;
select * from l_rc_ntp2 order by a,b,c,d,e;
  
  ## l_l_ntp
drop table if exists l_l_ntp1;
drop table if exists l_l_ntp2;
create table if not exists l_l_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list (a)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values in ( 1000, 2000),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( to_days('2023-11-01') ) (
subpartition p2sp1 values in ( 1000, 2000),
subpartition p2sp2 values in ( default )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values in ( 1000, 2000),
subpartition p3sp2 values in ( 3000, 4000),
subpartition p3sp3 values in ( default )
)
);
create table if not exists l_l_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list (a)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values in ( 1000, 2000),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( to_days('2023-11-01') ) (
subpartition p2sp1 values in ( 1000, 2000),
subpartition p2sp2 values in ( default )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values in ( 1000, 2000),
subpartition p3sp2 values in ( 3000, 4000),
subpartition p3sp3 values in ( default )
)
);
insert into l_l_ntp1 values (1000,2,'2020-01-01','abc','abc');
insert into l_l_ntp1 values (2000,2,'2023-11-01','abc','abc');
insert into l_l_ntp1 values (3000,2,'2040-01-01','abc','abc');
alter table l_l_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values in ( 1000, 2000 )));
alter table l_l_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));
insert into l_l_ntp1 values (2000,2,'2020-01-01','abc','abc');
insert into l_l_ntp1 values (2000,2,'2023-11-01','abc','abc');
insert into l_l_ntp1 values (4000,2,'2040-01-01','abc','abc');
insert into l_l_ntp1 values (5000,2,'2050-01-01','abc','abc');
insert into l_l_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into l_l_ntp2 values (2000,2,'2023-11-01','abc','abc');
insert into l_l_ntp2 values (3000,2,'2040-01-01','abc','abc');
alter table l_l_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values in ( 1000, 2000 )));
alter table l_l_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));
insert into l_l_ntp2 values (2000,2,'2020-01-01','abc','abc');
insert into l_l_ntp2 values (2000,2,'2023-11-01','abc','abc');
insert into l_l_ntp2 values (4000,2,'2040-01-01','abc','abc');
insert into l_l_ntp2 values (5000,2,'2050-01-01','abc','abc');
show full create table l_l_ntp1;
show full create table l_l_ntp2;
select * from l_l_ntp1 order by a,b,c,d,e;
select * from l_l_ntp2 order by a,b,c,d,e;
  
  ## l_lc_ntp
drop table if exists l_lc_ntp1;
drop table if exists l_lc_ntp2;
create table if not exists l_lc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list columns (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values in ( (1000, 2000) ),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( to_days('2022-01-01') ) (
subpartition p2sp1 values in ( (1000, 2000) ),
subpartition p2sp2 values in ( default )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values in ( (1000, 2000) ),
subpartition p3sp2 values in ( (2000, 2000) ),
subpartition p3sp3 values in ( default )
)
);
create table if not exists l_lc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list columns (a,b)
(
partition p1 values in ( to_days('2020-01-01') ) (
subpartition p1sp1 values in ( (1000, 2000) ),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( to_days('2022-01-01') ) (
subpartition p2sp1 values in ( (1000, 2000) ),
subpartition p2sp2 values in ( default )
),
partition p3 values in ( to_days('2040-01-01') ) (
subpartition p3sp1 values in ( (1000, 2000) ),
subpartition p3sp2 values in ( (2000, 2000) ),
subpartition p3sp3 values in ( default )
)
);
insert into l_lc_ntp1 values (1000,2,'2020-01-01','abc','abc');
insert into l_lc_ntp1 values (2000,2,'2022-01-01','abc','abc');
insert into l_lc_ntp1 values (3000,2,'2040-01-01','abc','abc');
alter table l_lc_ntp1 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values in ( (1000, 2000) )));
alter table l_lc_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));

insert into l_lc_ntp1 values (2000,2,'2020-01-01','abc','abc');
insert into l_lc_ntp1 values (3000,2,'2022-01-01','abc','abc');
insert into l_lc_ntp1 values (4000,2,'2040-01-01','abc','abc');
insert into l_lc_ntp1 values (4000,2,'2050-01-01','abc','abc');
insert into l_lc_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into l_lc_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into l_lc_ntp2 values (3000,2,'2040-01-01','abc','abc');
alter table l_lc_ntp2 add partition (partition p4 values in(to_days('2050-01-01')) (subpartition p4sp1 values in ( (1000, 2000) )));
alter table l_lc_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));
insert into l_lc_ntp2 values (2000,2,'2020-01-01','abc','abc');
insert into l_lc_ntp2 values (3000,2,'2022-01-01','abc','abc');
insert into l_lc_ntp2 values (4000,2,'2040-01-01','abc','abc');
insert into l_lc_ntp2 values (5000,2,'2050-01-01','abc','abc');

show full create table l_lc_ntp1;
show full create table l_lc_ntp2;
select * from l_lc_ntp1 order by a,b,c,d,e;
select * from l_lc_ntp2 order by a,b,c,d,e;
  
  ## lc_h_ntp
drop table if exists lc_h_ntp1;
drop table if exists lc_h_ntp2;
create table if not exists lc_h_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by hash (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) subpartitions 2,
partition p2 values in ( ('2022-01-01', 'abc') ) subpartitions 2,
partition p3 values in ( ('2040-01-01', 'abc') ) subpartitions 3
);
create table if not exists lc_h_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by hash (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) subpartitions 2,
partition p2 values in ( ('2022-01-01', 'abc') ) subpartitions 2,
partition p3 values in ( ('2040-01-01', 'abc') ) subpartitions 3
);
insert into lc_h_ntp1 values (1000,2,'2020-01-01','abc','abc');
insert into lc_h_ntp1 values (2000,2,'2022-01-01','abc','abc');
insert into lc_h_ntp1 values (3000,2,'2040-01-01','abc','abc');
alter table lc_h_ntp1 add partition (partition p4 values in ( ('2050-01-01', 'abc') ));
insert into lc_h_ntp1 values (2000,2,'2020-01-01','abc','abc');
insert into lc_h_ntp1 values (3000,2,'2022-01-01','abc','abc');
insert into lc_h_ntp1 values (4000,2,'2040-01-01','abc','abc');
insert into lc_h_ntp1 values (5000,2,'2050-01-01','abc','abc');
insert into lc_h_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into lc_h_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into lc_h_ntp2 values (3000,2,'2040-01-01','abc','abc');
alter table lc_h_ntp2 add partition (partition p4 values in ( ('2050-01-01', 'abc') ));
insert into lc_h_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into lc_h_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into lc_h_ntp2 values (3000,2,'2040-01-01','abc','abc');
insert into lc_h_ntp2 values (4000,2,'2050-01-01','abc','abc');

show full create table lc_h_ntp1;
show full create table lc_h_ntp2;
select * from lc_h_ntp1 order by a,b,c,d,e;
select * from lc_h_ntp2 order by a,b,c,d,e;
  
  ## lc_k_ntp
drop table if exists lc_k_ntp1;
drop table if exists lc_k_ntp2;
create table if not exists lc_k_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by key (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) subpartitions 2,
partition p2 values in ( ('2022-01-01', 'abc') ) subpartitions 2,
partition p3 values in ( ('2040-01-01', 'abc') ) subpartitions 3
);
create table if not exists lc_k_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by key (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) subpartitions 2,
partition p2 values in ( ('2022-01-01', 'abc') ) subpartitions 2,
partition p3 values in ( ('2040-01-01', 'abc') ) subpartitions 3
);
insert into lc_k_ntp1 values (1000,2,'2020-01-01','abc','abc');
insert into lc_k_ntp1 values (2000,2,'2022-01-01','abc','abc');
insert into lc_k_ntp1 values (3000,2,'2040-01-01','abc','abc');
alter table lc_k_ntp1 add partition (partition p4 values in ( ('2050-01-01', 'abc') ) subpartitions 2);
insert into lc_k_ntp1 values (2000,2,'2020-01-01','abc','abc');
insert into lc_k_ntp1 values (3000,2,'2022-01-01','abc','abc');
insert into lc_k_ntp1 values (4000,2,'2040-01-01','abc','abc');
insert into lc_k_ntp1 values (5000,2,'2050-01-01','abc','abc');
insert into lc_k_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into lc_k_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into lc_k_ntp2 values (3000,2,'2040-01-01','abc','abc');
alter table lc_k_ntp2 add partition (partition p4 values in ( ('2050-01-01', 'abc') ) subpartitions 2);
insert into lc_k_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into lc_k_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into lc_k_ntp2 values (3000,2,'2040-01-01','abc','abc');
insert into lc_k_ntp2 values (4000,2,'2050-01-01','abc','abc');

show full create table lc_k_ntp1;
show full create table lc_k_ntp2;
select * from lc_k_ntp1 order by a,b,c,d,e;
select * from lc_k_ntp2 order by a,b,c,d,e;
  
  ## lc_r_ntp
drop table if exists lc_r_ntp1;
drop table if exists lc_r_ntp2;
create table if not exists lc_r_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range (a)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values less than ( 1000),
subpartition p1sp2 values less than ( 200000 )
),
partition p2 values in ( ('2022-01-01', 'abc') ) (
subpartition p2sp1 values less than ( 1000),
subpartition p2sp2 values less than ( 200000 )
),
partition p3 values in ( ('2040-01-01', 'abc') ) (
subpartition p3sp1 values less than ( 1000),
subpartition p3sp2 values less than ( 2000),
subpartition p3sp3 values less than ( 200000 )
)
);
create table if not exists lc_r_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range (a)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values less than ( 1000),
subpartition p1sp2 values less than ( 200000 )
),
partition p2 values in ( ('2022-01-01', 'abc') ) (
subpartition p2sp1 values less than ( 1000),
subpartition p2sp2 values less than ( 200000 )
),
partition p3 values in ( ('2040-01-01', 'abc') ) (
subpartition p3sp1 values less than ( 1000),
subpartition p3sp2 values less than ( 2000),
subpartition p3sp3 values less than ( 200000 )
)
);
insert into lc_r_ntp1 values (1000,2,'2020-01-01','abc','abc');
insert into lc_r_ntp1 values (2000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp1 values (3000,2,'2040-01-01','abc','abc');
alter table lc_r_ntp1 add partition (partition p4 values in( ('2050-01-01', 'abc') ) (subpartition p4sp1 values less than ( 200000)));
alter table lc_r_ntp1 add partition (partition p5 values in( ('2060-01-01', 'abc') ) (subpartition p5sp1 values less than ( 200000)));
insert into lc_r_ntp1 values (2000,2,'2020-01-01','abc','abc');
insert into lc_r_ntp1 values (3000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp1 values (4000,2,'2040-01-01','abc','abc');
insert into lc_r_ntp1 values (4000,2,'2050-01-01','abc','abc');
insert into lc_r_ntp1 values (4000,2,'2060-01-01','abc','abc');
insert into lc_r_ntp2 values (1000,2,'2020-01-01','abc','abc');
insert into lc_r_ntp2 values (2000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp2 values (3000,2,'2040-01-01','abc','abc');
alter table lc_r_ntp2 add partition (partition p4 values in( ('2050-01-01', 'abc') ) (subpartition p4sp1 values less than ( 200000)));
alter table lc_r_ntp2 add partition (partition p6 values in ( ('2060-01-01', 'abc') ));
alter table lc_r_ntp2 drop partition p6;
alter table lc_r_ntp2 add partition (partition p5 values in( ('2060-01-01', 'abc') ) (subpartition p5sp1 values less than ( 200000)));

insert into lc_r_ntp2 values (2000,2,'2020-01-01','abc','abc');
insert into lc_r_ntp2 values (3000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp2 values (4000,2,'2040-01-01','abc','abc');
insert into lc_r_ntp2 values (4000,2,'2050-01-01','abc','abc');
insert into lc_r_ntp2 values (4000,2,'2060-01-01','abc','abc');

alter table lc_r_ntp1 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000));
insert into lc_r_ntp1 values (10000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp1 values (100000,20,'2022-01-01','abc','abc');
insert into lc_r_ntp1 values (200000,200,'2022-01-01','abc','abc');
insert into lc_r_ntp1 values (400000,2000,'2022-01-01','abc','abc');
alter table lc_r_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000));
insert into lc_r_ntp1 values (100000,30,'2050-01-01','abc','abc');
insert into lc_r_ntp1 values (200000,300,'2050-01-01','abc','abc');
insert into lc_r_ntp1 values (400000,3000,'2050-01-01','abc','abc');

alter table lc_r_ntp2 modify partition p2 add subpartition (subpartition p2sp3 values less than (500000));
insert into lc_r_ntp2 values (10000,2,'2022-01-01','abc','abc');
insert into lc_r_ntp2 values (100000,20,'2022-01-01','abc','abc');
insert into lc_r_ntp2 values (200000,200,'2022-01-01','abc','abc');
insert into lc_r_ntp2 values (400000,2000,'2022-01-01','abc','abc');
alter table lc_r_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values less than (500000));
insert into lc_r_ntp2 values (100000,30,'2050-01-01','abc','abc');
insert into lc_r_ntp2 values (200000,300,'2050-01-01','abc','abc');
insert into lc_r_ntp2 values (400000,3000,'2050-01-01','abc','abc');

show full create table lc_r_ntp1;
show full create table lc_r_ntp2;
select * from lc_r_ntp1 order by a,b,c,d,e;
select * from lc_r_ntp2 order by a,b,c,d,e;
  
  ## lc_rc_ntp
drop table if exists lc_rc_ntp1;
drop table if exists lc_rc_ntp2;
create table if not exists lc_rc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range columns (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values less than ( 1000, 10000),
subpartition p1sp2 values less than ( 200000,200000 )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values less than ( 1000, 10000),
subpartition p2sp2 values less than ( 2000, 10000),
subpartition p2sp3 values less than ( 200000,200000 )
)
);
create table if not exists lc_rc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range columns (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values less than ( 1000, 10000),
subpartition p1sp2 values less than ( 200000,200000 )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values less than ( 1000, 10000),
subpartition p2sp2 values less than ( 2000, 10000),
subpartition p2sp3 values less than ( 200000,200000 )
)
);
insert into lc_rc_ntp1 values (1000,10000,'2020-01-01','abc','abc');
insert into lc_rc_ntp1 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_rc_ntp1 values (3000,10000,'2040-01-01','abc','abc');
alter table lc_rc_ntp1 add partition (partition p3 values in( ('2050-01-01', 'abc') ) (subpartition p3sp1 values less than ( 200000,200000)));
insert into lc_rc_ntp1 values (2000,10000,'2020-01-01','abc','abc');
insert into lc_rc_ntp1 values (3000,10000,'2022-01-01','abc','abc');
insert into lc_rc_ntp1 values (4000,10000,'2040-01-01','abc','abc');
insert into lc_rc_ntp1 values (4000,10000,'2050-01-01','abc','abc');
insert into lc_rc_ntp2 values (1000,10000,'2020-01-01','abc','abc');
insert into lc_rc_ntp2 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_rc_ntp2 values (3000,10000,'2040-01-01','abc','abc');
alter table lc_rc_ntp2 add partition (partition p3 values in( ('2050-01-01', 'abc') ) (subpartition p3sp1 values less than ( 200000,200000)));
insert into lc_rc_ntp2 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_rc_ntp2 values (3000,10000,'2020-01-01','abc','abc');
insert into lc_rc_ntp2 values (4000,10000,'2040-01-01','abc','abc');

alter table lc_rc_ntp1 modify partition p2 add subpartition (subpartition p2sp4 values less than (500000,500000));
insert into lc_rc_ntp1 values (10000,2,'2022-01-01','abc','abc');
insert into lc_rc_ntp1 values (100000,20,'2022-01-01','abc','abc');
insert into lc_rc_ntp1 values (200000,200,'2022-01-01','abc','abc');
insert into lc_rc_ntp1 values (400000,2000,'2022-01-01','abc','abc');
alter table lc_rc_ntp1 modify partition p3 add subpartition (subpartition p3sp2 values less than (500000,500000));
insert into lc_rc_ntp1 values (100000,30,'2050-01-01','abc','abc');
insert into lc_rc_ntp1 values (200000,300,'2050-01-01','abc','abc');
insert into lc_rc_ntp1 values (400000,3000,'2050-01-01','abc','abc');

alter table lc_rc_ntp2 modify partition p2 add subpartition (subpartition p2sp4 values less than (500000,500000));
insert into lc_rc_ntp2 values (10000,2,'2022-01-01','abc','abc');
insert into lc_rc_ntp2 values (100000,20,'2022-01-01','abc','abc');
insert into lc_rc_ntp2 values (200000,200,'2022-01-01','abc','abc');
insert into lc_rc_ntp2 values (400000,2000,'2022-01-01','abc','abc');
alter table lc_rc_ntp2 modify partition p3 add subpartition (subpartition p3sp2 values less than (500000,500000));
insert into lc_rc_ntp2 values (100000,30,'2050-01-01','abc','abc');
insert into lc_rc_ntp2 values (200000,300,'2050-01-01','abc','abc');
insert into lc_rc_ntp2 values (400000,3000,'2050-01-01','abc','abc');

show full create table lc_rc_ntp1;
show full create table lc_rc_ntp2;
select * from lc_rc_ntp1 order by a,b,c,d,e;
select * from lc_rc_ntp2 order by a,b,c,d,e;
  
  ## lc_l_tp
drop table if exists lc_l_ntp1;
drop table if exists lc_l_ntp2;
create table if not exists lc_l_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list (a)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values in ( 1000, 2000),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values in ( 1000, 2000),
subpartition p2sp2 values in ( 3000, 4000),
subpartition p2sp3 values in ( default )
)
);
create table if not exists lc_l_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list (a)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values in ( 1000, 2000),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values in ( 1000, 2000),
subpartition p2sp2 values in ( 3000, 4000),
subpartition p2sp3 values in ( default )
)
);
insert into lc_l_ntp1 values (1000,10000,'2020-01-01','abc','abc');
insert into lc_l_ntp1 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_l_ntp1 values (3000,10000,'2040-01-01','abc','abc');
alter table lc_l_ntp1 add partition (partition p3 values in( ('2050-01-01', 'abc') ) (subpartition p3sp1 values in ( 1000, 2000)));
alter table lc_l_ntp1 modify partition p3 add subpartition (subpartition p3sp2 values in ( default ));
insert into lc_l_ntp1 values (2000,10000,'2020-01-01','abc','abc');
insert into lc_l_ntp1 values (3000,10000,'2022-01-01','abc','abc');
insert into lc_l_ntp1 values (4000,10000,'2040-01-01','abc','abc');
insert into lc_l_ntp1 values (5000,10000,'2050-01-01','abc','abc');
insert into lc_l_ntp2 values (1000,10000,'2020-01-01','abc','abc');
insert into lc_l_ntp2 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_l_ntp2 values (3000,10000,'2040-01-01','abc','abc');
alter table lc_l_ntp2 add partition (partition p3 values in( ('2060-01-01', 'abc') ) (subpartition p3sp1 values in ( 5000, 6000)));
alter table lc_l_ntp2 modify partition p3 add subpartition (subpartition p3sp2 values in ( default ));
insert into lc_l_ntp2 values (2000,10000,'2022-01-01','abc','abc');
insert into lc_l_ntp2 values (3000,10000,'2020-01-01','abc','abc');
insert into lc_l_ntp2 values (4000,10000,'2040-01-01','abc','abc');
insert into lc_l_ntp2 values (4000,10000,'2060-01-01','abc','abc');
show full create table lc_l_ntp1;
show full create table lc_l_ntp2;
select * from lc_l_ntp1 order by a,b,c,d,e;
select * from lc_l_ntp2 order by a,b,c,d,e;
  
  ## lc_lc_ntp
drop table if exists lc_lc_ntp1;
drop table if exists lc_lc_ntp2;
create table if not exists lc_lc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list columns (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values in ( (1000, 2000) ),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values in ( (1000, 2000) ),
subpartition p2sp2 values in ( (2000, 2000) ),
subpartition p2sp3 values in ( default )
)
);
create table if not exists lc_lc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list columns (a,b)
(
partition p1 values in ( ('2020-01-01', 'abc') ) (
subpartition p1sp1 values in ( (1000, 2000) ),
subpartition p1sp2 values in ( default )
),
partition p2 values in ( ('2022-01-01', 'abc'),('2040-01-01', 'abc') ) (
subpartition p2sp1 values in ( (1000, 2000) ),
subpartition p2sp2 values in ( (2000, 2000) ),
subpartition p2sp3 values in ( default )
)
);
insert into lc_lc_ntp1 values (1000,2000,'2020-01-01','abc','abc');
insert into lc_lc_ntp1 values (2000,2000,'2022-01-01','abc','abc');
insert into lc_lc_ntp1 values (3000,2000,'2040-01-01','abc','abc');
alter table lc_lc_ntp1 add partition (partition p3 values in ( ('2050-01-01', 'abc') ));
alter table lc_lc_ntp1 add partition (partition p4 values in ( ('2060-01-01', 'abc') ) (subpartition p4sp1 values in (( 5000, 6000))));
alter table lc_lc_ntp1 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));
insert into lc_lc_ntp1 values (2000,2000,'2020-01-01','abc','abc');
insert into lc_lc_ntp1 values (3000,2000,'2022-01-01','abc','abc');
insert into lc_lc_ntp1 values (4000,2000,'2040-01-01','abc','abc');
insert into lc_lc_ntp1 values (4000,2000,'2050-01-01','abc','abc');
insert into lc_lc_ntp1 values (5000,6000,'2060-01-01','abc','abc');
insert into lc_lc_ntp2 values (1000,2000,'2020-01-01','abc','abc');
insert into lc_lc_ntp2 values (2000,2000,'2022-01-01','abc','abc');
insert into lc_lc_ntp2 values (3000,2000,'2040-01-01','abc','abc');
alter table lc_lc_ntp2 add partition (partition p3 values in ( ('2050-01-01', 'abc') ));
alter table lc_lc_ntp2 add partition (partition p4 values in ( ('2060-01-01', 'abc') ) (subpartition p4sp1 values in (( 5000, 6000))));
alter table lc_lc_ntp2 modify partition p4 add subpartition (subpartition p4sp2 values in ( default ));
insert into lc_lc_ntp2 values (2000,2000,'2020-01-01','abc','abc');
insert into lc_lc_ntp2 values (3000,2000,'2022-01-01','abc','abc');
insert into lc_lc_ntp2 values (4000,2000,'2040-01-01','abc','abc');
insert into lc_lc_ntp2 values (4000,2000,'2050-01-01','abc','abc');
insert into lc_lc_ntp2 values (5000,6000,'2060-01-01','abc','abc');
show full create table lc_lc_ntp1;
show full create table lc_lc_ntp2;
select * from lc_lc_ntp1 order by a,b,c,d,e;
select * from lc_lc_ntp2 order by a,b,c,d,e;
