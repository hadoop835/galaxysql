## DISABLE_FAST_SQL_PARSER
## h_r_ntp
drop table if exists h_r_ntp1;
drop table if exists h_r_ntp2;
drop table if exists h_r_ntp3;
create table if not exists h_r_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by range (to_days(c))
(
partition p1
(
subpartition p1sp1 values less than ( to_days('2020-01-01') ),
subpartition p1sp2 values less than ( to_days('2041-01-01') )
),
partition p2
(
subpartition p2sp1 values less than ( to_days('2020-01-01') ),
subpartition p2sp2 values less than ( to_days('2021-01-01') ),
subpartition p2sp3 values less than ( to_days('2041-01-01') )
)
);

create table if not exists h_r_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by range (to_days(c))
(
partition p1
(
subpartition p1sp1 values less than ( to_days('2020-01-01') ),
subpartition p1sp2 values less than ( to_days('2041-01-01') )
),
partition p2
(
subpartition p2sp1 values less than ( to_days('2020-01-01') ),
subpartition p2sp2 values less than ( to_days('2021-01-01') ),
subpartition p2sp3 values less than ( to_days('2041-01-01') )
)
);

create table if not exists h_r_ntp3 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by range (to_days(c))
(
partition p1
(
subpartition p1sp1 values less than ( to_days('2020-01-01') ),
subpartition p1sp2 values less than ( to_days('2041-01-01') )
),
partition p2
(
subpartition p2sp1 values less than ( to_days('2020-01-01') ),
subpartition p2sp2 values less than ( to_days('2021-01-01') ),
subpartition p2sp3 values less than ( to_days('2041-01-01') )
)
);
insert into h_r_ntp1 values (1,2,'2010-01-01','abc','abc');
insert into h_r_ntp1 values (1,2,'2020-10-01','abc','abc');
insert into h_r_ntp1 values (1,2,'2040-01-01','abc','abc');
alter table h_r_ntp1 modify partition p1 add subpartition (subpartition p1sp3 values less than(to_days('2042-01-01')));
insert into h_r_ntp1 values (10,2,'2010-01-01','abc','abc');
insert into h_r_ntp1 values (10,2,'2020-10-01','abc','abc');
insert into h_r_ntp1 values (10,2,'2040-01-01','abc','abc');
alter table h_r_ntp1 modify partition p2 add subpartition (subpartition p2sp4 values less than(to_days('2042-01-01')));
insert into h_r_ntp1 values (20,2,'2010-01-01','abc','abc');
insert into h_r_ntp1 values (20,2,'2020-10-01','abc','abc');
insert into h_r_ntp1 values (20,2,'2041-01-01','abc','abc');
insert into h_r_ntp2 values (1,2,'2010-01-01','abc','abc');
insert into h_r_ntp2 values (1,2,'2020-10-01','abc','abc');
insert into h_r_ntp2 values (1,2,'2040-01-01','abc','abc');
alter table h_r_ntp2 modify partition p1 add subpartition (subpartition p1sp3 values less than(to_days('2042-01-01')));
insert into h_r_ntp2 values (10,2,'2010-01-01','abc','abc');
insert into h_r_ntp2 values (10,2,'2020-10-01','abc','abc');
insert into h_r_ntp2 values (10,2,'2040-01-01','abc','abc');
alter table h_r_ntp2 modify partition p2 add subpartition (subpartition p2sp4 values less than(to_days('2042-01-01')));
insert into h_r_ntp2 values (20,2,'2010-01-01','abc','abc');
insert into h_r_ntp2 values (20,2,'2020-10-01','abc','abc');
insert into h_r_ntp2 values (20,2,'2041-01-01','abc','abc');

insert into h_r_ntp3 values (1,2,'2010-01-01','abc','abc');
insert into h_r_ntp3 values (1,2,'2020-10-01','abc','abc');
insert into h_r_ntp3 values (1,2,'2040-01-01','abc','abc');
alter table h_r_ntp3 modify partition p1 add subpartition (subpartition p1sp3 values less than(to_days('2042-01-01')));
insert into h_r_ntp3 values (10,2,'2010-01-01','abc','abc');
insert into h_r_ntp3 values (10,2,'2020-10-01','abc','abc');
insert into h_r_ntp3 values (10,2,'2040-01-01','abc','abc');
alter table h_r_ntp3 modify partition p1 add subpartition (subpartition p1sp4 values less than(to_days('2043-01-01')));
insert into h_r_ntp3 values (20,2,'2010-01-01','abc','abc');
insert into h_r_ntp3 values (20,2,'2020-10-01','abc','abc');
insert into h_r_ntp3 values (20,2,'2040-01-01','abc','abc');

alter table h_r_ntp2 drop subpartition p1sp1;
alter table h_r_ntp2 drop subpartition p2sp1,p2sp3;
alter table h_r_ntp3 drop subpartition p1sp1;
insert into h_r_ntp3 values (5,2,'2010-01-01','abc','abc');
insert into h_r_ntp3 values (5,2,'2020-10-01','abc','abc');
insert into h_r_ntp3 values (5,2,'2040-01-01','abc','abc');
alter table h_r_ntp3 drop subpartition p2sp1,p2sp3;
insert into h_r_ntp3 values (6,2,'2010-01-01','abc','abc');
insert into h_r_ntp3 values (6,2,'2020-10-01','abc','abc');
insert into h_r_ntp3 values (6,2,'2040-01-01','abc','abc');
show full create table h_r_ntp1;
show full create table h_r_ntp2;
show full create table h_r_ntp3;
select * from h_r_ntp1 order by a,b,c,d,e;
select * from h_r_ntp2 order by a,b,c,d,e;
select * from h_r_ntp3 order by a,b,c,d,e;

## h_rc_ntp
drop table if exists h_rc_ntp1;
drop table if exists h_rc_ntp2;
create table if not exists h_rc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by range columns (c,d)
(
partition p1
(
subpartition p1sp1 values less than ( '2020-01-01', 'abc' ),
subpartition p1sp2 values less than ( '2041-01-01', 'abc' )
),
partition p2
(
subpartition p2sp1 values less than ( '2020-01-01', 'abc' ),
subpartition p2sp2 values less than ( '2021-01-01', 'abc' ),
subpartition p2sp3 values less than ( '2041-01-01', 'abc' )
)
);
create table if not exists h_rc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by range columns (c,d)
(
partition p1
(
subpartition p1sp1 values less than ( '2020-01-01', 'abc' ),
subpartition p1sp2 values less than ( '2041-01-01', 'abc' )
),
partition p2
(
subpartition p2sp1 values less than ( '2020-01-01', 'abc' ),
subpartition p2sp2 values less than ( '2021-01-01', 'abc' ),
subpartition p2sp3 values less than ( '2041-01-01', 'abc' )
)
);



insert into h_rc_ntp1 values (1,2,'2010-01-01','abc','abc');
insert into h_rc_ntp1 values (1,2,'2020-10-01','abc','abc');
insert into h_rc_ntp1 values (1,2,'2040-01-01','abc','abc');
alter table h_rc_ntp1 modify partition p1 add subpartition (subpartition p1sp3 values less than('2042-01-01','abc'));
insert into h_rc_ntp1 values (10,2,'2010-01-01','abc','abc');
insert into h_rc_ntp1 values (10,2,'2020-10-01','abc','abc');
insert into h_rc_ntp1 values (10,2,'2040-01-01','abc','abc');
alter table h_rc_ntp1 modify partition p2 add subpartition (subpartition p2sp4 values less than('2042-01-01','abc'));
insert into h_rc_ntp1 values (20,2,'2010-01-01','abc','abc');
insert into h_rc_ntp1 values (20,2,'2020-10-01','abc','abc');
insert into h_rc_ntp1 values (20,2,'2041-01-01','abc','abc');
insert into h_rc_ntp2 values (1,2,'2010-01-01','abc','abc');
insert into h_rc_ntp2 values (1,2,'2020-10-01','abc','abc');
insert into h_rc_ntp2 values (1,2,'2040-01-01','abc','abc');
alter table h_rc_ntp2 modify partition p1 add subpartition (subpartition p1sp3 values less than('2042-01-01','abc'));
insert into h_rc_ntp2 values (10,2,'2010-01-01','abc','abc');
insert into h_rc_ntp2 values (10,2,'2020-10-01','abc','abc');
insert into h_rc_ntp2 values (10,2,'2040-01-01','abc','abc');
alter table h_rc_ntp2 modify partition p2 add subpartition (subpartition p2sp4 values less than(maxvalue,maxvalue));
insert into h_rc_ntp2 values (20,2,'2010-01-01','abc','abc');
insert into h_rc_ntp2 values (20,2,'2020-10-01','abc','abc');
insert into h_rc_ntp2 values (20,2,'2041-01-01','abc','abc');
alter table h_rc_ntp1 drop subpartition p2sp1,p2sp3;
insert into h_rc_ntp1 values (2,2,'2010-01-01','abc','abc');
insert into h_rc_ntp1 values (2,2,'2020-10-01','abc','abc');
insert into h_rc_ntp1 values (2,2,'2040-01-01','abc','abc');
alter table h_rc_ntp2 drop subpartition p2sp1,p2sp3;
insert into h_rc_ntp2 values (4,2,'2010-01-01','abc','abc');
insert into h_rc_ntp2 values (4,2,'2020-10-01','abc','abc');
insert into h_rc_ntp2 values (4,2,'2040-01-01','abc','abc');
show full create table h_rc_ntp1;
show full create table h_rc_ntp2;
select * from h_rc_ntp1 order by a,b,c,d,e;
select * from h_rc_ntp2 order by a,b,c,d,e;

## h_l_ntp
drop table if exists h_l_ntp1;
drop table if exists h_l_ntp2;
create table if not exists h_l_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by list (to_days(c))
(
partition p1
(
subpartition p1sp1 values in ( to_days('2020-01-01') ),
subpartition p1sp2 values in ( to_days('2021-01-01') )
),
partition p2
(
subpartition p2sp1 values in ( to_days('2020-01-01') ),
subpartition p2sp2 values in ( to_days('2021-01-01') ),
subpartition p2sp3 values in ( to_days('2022-01-01') )
)
);
create table if not exists h_l_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by list (to_days(c))
(
partition p1
(
subpartition p1sp1 values in ( to_days('2020-01-01') ),
subpartition p1sp2 values in ( to_days('2021-01-01') )
),
partition p2
(
subpartition p2sp1 values in ( to_days('2020-01-01') ),
subpartition p2sp2 values in ( to_days('2021-01-01') ),
subpartition p2sp3 values in ( to_days('2022-01-01') )
)
);
insert into h_l_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into h_l_ntp1 values (1,2,'2021-01-01','abc','abc');
alter table h_l_ntp1 modify partition p1 add subpartition (subpartition p1sp3 values in (to_days('2022-01-01')));
insert into h_l_ntp1 values (10,2,'2020-01-01','abc','abc');
insert into h_l_ntp1 values (10,2,'2021-01-01','abc','abc');
insert into h_l_ntp1 values (10,2,'2022-01-01','abc','abc');
alter table h_l_ntp1 modify partition p2 add subpartition (subpartition p2sp4 values in (default));
insert into h_l_ntp1 values (20,2,'2020-01-01','abc','abc');
insert into h_l_ntp1 values (20,2,'2021-01-01','abc','abc');
insert into h_l_ntp1 values (20,2,'2022-01-01','abc','abc');
alter table h_l_ntp2 values (1,2,'2020-01-01','abc','abc');
insert into h_l_ntp2 values (1,2,'2021-01-01','abc','abc');
alter table h_l_ntp2 modify partition p1 add subpartition (subpartition p1sp3 values in (default));
insert into h_l_ntp2 values (10,2,'2020-01-01','abc','abc');
insert into h_l_ntp2 values (10,2,'2021-01-01','abc','abc');
insert into h_l_ntp2 values (10,2,'2022-01-01','abc','abc');
alter table h_l_ntp2 modify partition p2 add subpartition (subpartition p2sp4 values in (default));
insert into h_l_ntp2 values (20,2,'2020-01-01','abc','abc');
insert into h_l_ntp2 values (20,2,'2021-01-01','abc','abc');
insert into h_l_ntp2 values (20,2,'2022-01-01','abc','abc');
insert into h_l_ntp2 values (10,2,'2050-01-01','abc','abc');
alter table h_l_ntp1 drop subpartition p2sp1,p2sp3;
alter table h_l_ntp2 drop subpartition p1sp3;
alter table h_l_ntp2 drop subpartition p2sp4;
insert into h_l_ntp2 values (3,2,'2020-01-01','abc','abc');
insert into h_l_ntp2 values (3,2,'2021-01-01','abc','abc');
show full create table h_l_ntp1;
show full create table h_l_ntp2;
select * from h_l_ntp1 order by a,b,c,d,e;
select * from h_l_ntp2 order by a,b,c,d,e;

## h_lc_tp
drop table if exists h_lc_ntp1;
drop table if exists h_lc_ntp2;
create table if not exists h_lc_ntp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by list columns (c,d)
(
partition p1
(
subpartition p1sp1 values in ( ('2020-01-01', 'abc') ),
subpartition p1sp2 values in ( ('2021-01-01', 'abc') )
),
partition p2
(
subpartition p2sp1 values in ( ('2020-01-01', 'abc') ),
subpartition p2sp2 values in ( ('2021-01-01', 'abc') ),
subpartition p2sp3 values in ( ('2022-01-01', 'abc') )
)
);
create table if not exists h_lc_ntp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by hash (a,b) partitions 2
subpartition by list columns (c,d)
(
partition p1
(
subpartition p1sp1 values in ( ('2020-01-01', 'abc') ),
subpartition p1sp2 values in ( ('2021-01-01', 'abc') )
),
partition p2
(
subpartition p2sp1 values in ( ('2020-01-01', 'abc') ),
subpartition p2sp2 values in ( ('2021-01-01', 'abc') ),
subpartition p2sp3 values in ( ('2022-01-01', 'abc') )
)
);
insert into h_lc_ntp1 values (1,2,'2020-01-01','abc','abc');
insert into h_lc_ntp1 values (1,2,'2021-01-01','abc','abc');
alter table h_lc_ntp1 modify partition p1 add subpartition (subpartition p1sp3 values in (('2022-01-01','abc')));
insert into h_lc_ntp1 values (10,2,'2020-01-01','abc','abc');
insert into h_lc_ntp1 values (10,2,'2021-01-01','abc','abc');
insert into h_lc_ntp1 values (10,2,'2022-01-01','abc','abc');
alter table h_lc_ntp1 modify partition p2 add subpartition (subpartition p2sp4 values in (default));
insert into h_lc_ntp1 values (20,2,'2020-01-01','abc','abc');
insert into h_lc_ntp1 values (20,2,'2021-01-01','abc','abc');
insert into h_lc_ntp1 values (20,2,'2022-01-01','abc','abc');
insert into h_lc_ntp2 values (1,2,'2020-01-01','abc','abc');
insert into h_lc_ntp2 values (1,2,'2021-01-01','abc','abc');
alter table h_lc_ntp2 modify partition p1 add subpartition (subpartition p1sp3 values in (default));
insert into h_lc_ntp2 values (10,2,'2020-01-01','abc','abc');
insert into h_lc_ntp2 values (10,2,'2021-01-01','abc','abc');
insert into h_lc_ntp2 values (10,2,'2022-01-01','abc','abc');
alter table h_lc_ntp2 modify partition p2 add subpartition (subpartition p2sp4 values in (default));
insert into h_lc_ntp2 values (3,2,'2020-01-01','abc','abc');
insert into h_lc_ntp2 values (3,2,'2021-01-01','abc','abc');
insert into h_lc_ntp2 values (3,2,'2040-01-01','abc','abc');

alter table h_lc_ntp1 drop subpartition p2sp4,p1sp3;
insert into h_lc_ntp1 values (2,2,'2020-01-01','abc','abc');
insert into h_lc_ntp1 values (2,2,'2021-01-01','abc','abc');
show full create table h_lc_ntp1;
show full create table h_lc_ntp2;
select * from h_lc_ntp1 order by a,b,c,d,e;
select * from h_lc_ntp2 order by a,b,c,d,e;