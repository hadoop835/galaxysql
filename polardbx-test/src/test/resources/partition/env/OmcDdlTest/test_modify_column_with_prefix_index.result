## DISABLE_FAST_SQL_PARSER
set @sql_mode_tmp1 = @@sql_mode
set sql_mode=''
drop table if exists omc_with_prefix_idx_t1
create table omc_with_prefix_idx_t1 (
  a int,
  b bigint,
  c varchar(30),
  d varchar(100),
  index idx_bcd(b,c(20),d),
  index idx_bcd_prefix(b,c(10),d(20)),
  global index gsi_dbc(b,c(20),d) partition by key(b),
  primary key(a)
) engine = InnoDB
partition by key(a)
insert into omc_with_prefix_idx_t1 values (1, 101, 'a', '1111111'),
(2, 102, 'b', '2222222'),
(3, 103, 'c', '3333333'),
(4, 201, 'd', '4444444'),
(5, 202, 'e', '5555555'),
(6, 203, 'f', '6666666'),
(7, 301, 'g', '7777777')
select * from omc_with_prefix_idx_t1 order by a
a,b,c,d
1,101,a,1111111
2,102,b,2222222
3,103,c,3333333
4,201,d,4444444
5,202,e,5555555
6,203,f,6666666
7,301,g,7777777
alter table omc_with_prefix_idx_t1 modify column b varchar(100), ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` varchar(30) DEFAULT NULL,
	`d` varchar(100) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`(20), `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`(20), `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`(10), `d`(20))
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column c varchar(40), ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` varchar(40) DEFAULT NULL,
	`d` varchar(100) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`(20), `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`(20), `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`(10), `d`(20))
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column c char(50), ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` char(50) DEFAULT NULL,
	`d` varchar(100) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`(20), `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`(20), `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`(10), `d`(20))
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column c text, ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` text,
	`d` varchar(100) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`(20), `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`(20), `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`(10), `d`(20))
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column c varchar(15), ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` varchar(15) DEFAULT NULL,
	`d` varchar(100) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`, `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`, `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`(10), `d`(20))
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column c varchar(5), modify column d int after c, ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` varchar(100) DEFAULT NULL,
	`c` varchar(5) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`, `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`, `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`, `d`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
alter table omc_with_prefix_idx_t1 modify column b bigint, ALGORITHM=OMC
show full create table omc_with_prefix_idx_t1
Table,Create Table
omc_with_prefix_idx_t1,CREATE TABLE `omc_with_prefix_idx_t1` (
	`a` int(11) NOT NULL,
	`b` bigint(20) DEFAULT NULL,
	`c` varchar(5) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	GLOBAL INDEX /* gsi_dbc_$ */ `gsi_dbc` (`b`, `c`, `d`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	LOCAL KEY `idx_bcd` (`b`, `c`, `d`),
	LOCAL KEY `idx_bcd_prefix` (`b`, `c`, `d`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
/* tablegroup = `tg` */
select * from omc_with_prefix_idx_t1 order by a
a,b,c,d
1,101,a,1111111
2,102,b,2222222
3,103,c,3333333
4,201,d,4444444
5,202,e,5555555
6,203,f,6666666
7,301,g,7777777
set sql_mode = @sql_mode_tmp1;