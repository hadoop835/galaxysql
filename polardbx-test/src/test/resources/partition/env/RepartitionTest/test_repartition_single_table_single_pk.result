DROP TABLE IF EXISTS r_s_pk_t1
DROP TABLE IF EXISTS r_s_pk_t2
DROP TABLE IF EXISTS r_s_pk_t3
CREATE TABLE r_s_pk_t1 (
	a int,
	b int,
	c int,
	PRIMARY KEY (a)
) SINGLE
INSERT INTO r_s_pk_t1
VALUES (1, 1, 1),
	(2, 2, 2),
	(3, 3, 3)
ALTER TABLE r_s_pk_t1
PARTITION BY KEY (a) PARTITIONS 1
SHOW CREATE TABLE r_s_pk_t1
Table,Create Table
r_s_pk_t1,CREATE TABLE `r_s_pk_t1` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 1
SELECT *
FROM r_s_pk_t1
ORDER BY a
a,b,c
1,1,1
2,2,2
3,3,3
ALTER TABLE r_s_pk_t1
	ADD UNIQUE GLOBAL INDEX ugsi_b (b) PARTITION BY KEY (b)
SHOW CREATE TABLE r_s_pk_t1
Table,Create Table
r_s_pk_t1,CREATE TABLE `r_s_pk_t1` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_b` (`b`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 1
ALTER TABLE r_s_pk_t1
PARTITION BY KEY (a) PARTITIONS 3
SHOW CREATE TABLE r_s_pk_t1
Table,Create Table
r_s_pk_t1,CREATE TABLE `r_s_pk_t1` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_b` (`b`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
SELECT *
FROM r_s_pk_t1
ORDER BY a
a,b,c
1,1,1
2,2,2
3,3,3
CREATE TABLE r_s_pk_t2 (
	a int,
	b int,
	c int,
	PRIMARY KEY (a)
) SINGLE
INSERT INTO r_s_pk_t2
VALUES (1, 1, 1),
	(2, 2, 2),
	(3, 3, 3)
ALTER TABLE r_s_pk_t2
PARTITION BY KEY (b) PARTITIONS 1
SHOW CREATE TABLE r_s_pk_t2
Table,Create Table
r_s_pk_t2,CREATE TABLE `r_s_pk_t2` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`b`)
PARTITIONS 1
SELECT *
FROM r_s_pk_t2
a,b,c
1,1,1
2,2,2
3,3,3
ALTER TABLE r_s_pk_t2
	ADD UNIQUE GLOBAL INDEX ugsi_c (c) PARTITION BY KEY (c)
SHOW CREATE TABLE r_s_pk_t2
Table,Create Table
r_s_pk_t2,CREATE TABLE `r_s_pk_t2` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_c` (`c`) COVERING (`b`)
		PARTITION BY KEY(`c`)
		PARTITIONS 3
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`b`)
PARTITIONS 1
ALTER TABLE r_s_pk_t2
PARTITION BY KEY (b) PARTITIONS 3
SHOW CREATE TABLE r_s_pk_t2
Table,Create Table
r_s_pk_t2,CREATE TABLE `r_s_pk_t2` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_c` (`c`) COVERING (`b`)
		PARTITION BY KEY(`c`)
		PARTITIONS 3,
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`b`)
PARTITIONS 3
SELECT *
FROM r_s_pk_t2
ORDER BY a
a,b,c
1,1,1
2,2,2
3,3,3
CREATE TABLE r_s_pk_t3 (
	a int,
	b int,
	c int,
	PRIMARY KEY (a)
) SINGLE
INSERT INTO r_s_pk_t3
VALUES (1, 1, 1),
	(2, 2, 2),
	(3, 3, 3)
ALTER TABLE r_s_pk_t3
PARTITION BY KEY (a, b) PARTITIONS 1
SHOW CREATE TABLE r_s_pk_t3
Table,Create Table
r_s_pk_t3,CREATE TABLE `r_s_pk_t3` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 1
SELECT *
FROM r_s_pk_t3
a,b,c
1,1,1
2,2,2
3,3,3
ALTER TABLE r_s_pk_t3
	ADD UNIQUE GLOBAL INDEX ugsi_c (c) PARTITION BY KEY (c)
SHOW CREATE TABLE r_s_pk_t3
Table,Create Table
r_s_pk_t3,CREATE TABLE `r_s_pk_t3` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_c` (`c`) COVERING (`b`)
		PARTITION BY KEY(`c`)
		PARTITIONS 3
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 1
ALTER TABLE r_s_pk_t3
PARTITION BY KEY (a, b) PARTITIONS 3
SHOW CREATE TABLE r_s_pk_t3
Table,Create Table
r_s_pk_t3,CREATE TABLE `r_s_pk_t3` (
	`a` int(11) NOT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	PRIMARY KEY (`a`),
	UNIQUE GLOBAL INDEX `ugsi_c` (`c`) COVERING (`b`)
		PARTITION BY KEY(`c`)
		PARTITIONS 3,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 3
SELECT *
FROM r_s_pk_t3
ORDER BY a
a,b,c
1,1,1
2,2,2
3,3,3