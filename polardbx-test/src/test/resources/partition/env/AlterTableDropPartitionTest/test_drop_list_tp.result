## DISABLE_FAST_SQL_PARSER
  ## l_h_tp
drop table if exists l_h_tp1
drop table if exists l_h_tp2
create table if not exists l_h_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by hash (a,b) subpartitions 4
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_h_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by hash (a,b) subpartitions 4
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_h_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_h_tp1 values (1,2,'2020-01-01','aa','bb')
insert into l_h_tp1 values (1,2,'2040-01-01','aa','bb')
alter table l_h_tp1 drop partition p1
insert into l_h_tp1 values (2,2,'2010-01-01','aa','bb')
insert into l_h_tp1 values (2,2,'2020-01-01','aa','bb')
insert into l_h_tp1 values (2,2,'2040-01-01','aa','bb')
insert into l_h_tp2 values (1,2,'2010-01-01','aa','bb')
insert into l_h_tp2 values (1,2,'2020-01-01','aa','bb')
insert into l_h_tp2 values (1,2,'2040-01-01','aa','bb')
alter table l_h_tp2 drop partition p1
insert into l_h_tp2 values (2,2,'2010-01-01','aa','bb')
insert into l_h_tp2 values (2,2,'2020-01-01','aa','bb')
insert into l_h_tp2 values (2,2,'2040-01-01','aa','bb')
show full create table l_h_tp1
Table,Create Table
l_h_tp1,CREATE TABLE `l_h_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY HASH(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_h_tp2
Table,Create Table
l_h_tp2,CREATE TABLE `l_h_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY HASH(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from l_h_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,aa,bb
1,2,2040-01-01 00:00:00.0,aa,bb
2,2,2010-01-01 00:00:00.0,aa,bb
2,2,2020-01-01 00:00:00.0,aa,bb
2,2,2040-01-01 00:00:00.0,aa,bb
select * from l_h_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,aa,bb
1,2,2040-01-01 00:00:00.0,aa,bb
2,2,2010-01-01 00:00:00.0,aa,bb
2,2,2020-01-01 00:00:00.0,aa,bb
2,2,2040-01-01 00:00:00.0,aa,bb
## l_k_tp
drop table if exists l_k_tp1
drop table if exists l_k_tp2
create table if not exists l_k_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by key (a,b) subpartitions 4
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_k_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by key (a,b) subpartitions 4
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_k_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_k_tp1 values (1,2,'2020-01-01','aa','bb')
insert into l_k_tp1 values (1,2,'2040-01-01','aa','bb')
alter table l_k_tp1 drop partition p1
insert into l_k_tp1 values (2,2,'2010-01-01','aa','bb')
insert into l_k_tp1 values (2,2,'2020-01-01','aa','bb')
insert into l_k_tp1 values (2,2,'2040-01-01','aa','bb')
insert into l_k_tp2 values (1,2,'2010-01-01','aa','bb')
insert into l_k_tp2 values (1,2,'2020-01-01','aa','bb')
insert into l_k_tp2 values (1,2,'2040-01-01','aa','bb')
alter table l_k_tp2 drop partition p2
insert into l_k_tp2 values (2,2,'2020-01-01','aa','bb')
show full create table l_k_tp1
Table,Create Table
l_k_tp1,CREATE TABLE `l_k_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY KEY(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_k_tp2
Table,Create Table
l_k_tp2,CREATE TABLE `l_k_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY KEY(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p1 VALUES IN (737790))
/* tablegroup = `tg` */
select * from l_k_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,aa,bb
1,2,2040-01-01 00:00:00.0,aa,bb
2,2,2010-01-01 00:00:00.0,aa,bb
2,2,2020-01-01 00:00:00.0,aa,bb
2,2,2040-01-01 00:00:00.0,aa,bb
select * from l_k_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2020-01-01 00:00:00.0,aa,bb
2,2,2020-01-01 00:00:00.0,aa,bb
## l_r_tp
drop table if exists l_r_tp1
drop table if exists l_r_tp2
create table if not exists l_r_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range (a)
(
subpartition sp1 values less than ( 1000),
subpartition sp2 values less than ( maxvalue )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_r_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range (a)
(
subpartition sp1 values less than ( 1000),
subpartition sp2 values less than ( maxvalue )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_r_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_r_tp1 values (1,2,'2020-01-01','aa','bb')
insert into l_r_tp1 values (1,2,'2040-01-01','aa','bb')
alter table l_r_tp1 drop partition p1
insert into l_r_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_r_tp1 values (1000,2,'2020-01-01','aa','bb')
insert into l_r_tp1 values (2000,2,'2040-01-01','aa','bb')
alter table l_r_tp1 drop subpartition sp1
insert into l_r_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_r_tp1 values (1000,2,'2020-01-01','aa','bb')
insert into l_r_tp1 values (2000,2,'2040-01-01','aa','bb')
insert into l_r_tp2 values (1,2,'2010-01-01','aa','bb')
insert into l_r_tp2 values (1,2,'2020-01-01','aa','bb')
insert into l_r_tp2 values (1,2,'2040-01-01','aa','bb')
alter table l_r_tp2 drop subpartition sp2
insert into l_r_tp1 values (10,2,'2010-01-01','aa','bb')
insert into l_r_tp1 values (100,2,'2020-01-01','aa','bb')
insert into l_r_tp1 values (500,2,'2040-01-01','aa','bb')
alter table l_r_tp2 drop partition p2
insert into l_r_tp2 values (500,2,'2020-01-01','aa','bb')
show full create table l_r_tp1
Table,Create Table
l_r_tp1,CREATE TABLE `l_r_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY RANGE(`a`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_r_tp2
Table,Create Table
l_r_tp2,CREATE TABLE `l_r_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY RANGE(`a`)
(SUBPARTITION sp1 VALUES LESS THAN (1000))
(PARTITION p1 VALUES IN (737790))
/* tablegroup = `tg` */
select * from l_r_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,aa,bb
10,2,2010-01-01 00:00:00.0,aa,bb
100,2,2020-01-01 00:00:00.0,aa,bb
500,2,2040-01-01 00:00:00.0,aa,bb
1000,2,2020-01-01 00:00:00.0,aa,bb
1000,2,2020-01-01 00:00:00.0,aa,bb
2000,2,2040-01-01 00:00:00.0,aa,bb
2000,2,2040-01-01 00:00:00.0,aa,bb
select * from l_r_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2020-01-01 00:00:00.0,aa,bb
500,2,2020-01-01 00:00:00.0,aa,bb
## l_rc_tp
drop table if exists l_rc_tp1
drop table if exists l_rc_tp2
create table if not exists l_rc_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range columns (a,b)
(
subpartition sp1 values less than ( 1000, 10000),
subpartition sp2 values less than ( maxvalue, maxvalue )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_rc_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by range columns (a,b)
(
subpartition sp1 values less than ( 1000, 10000),
subpartition sp2 values less than ( maxvalue, maxvalue )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_rc_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_rc_tp1 values (1,2,'2020-01-01','aa','bb')
insert into l_rc_tp1 values (1,2,'2040-01-01','aa','bb')
alter table l_rc_tp1 drop partition p1
insert into l_rc_tp1 values (1000,2,'2010-01-01','aa','bb')
insert into l_rc_tp1 values (1000,2,'2020-01-01','aa','bb')
insert into l_rc_tp1 values (2000,2,'2040-01-01','aa','bb')
alter table l_rc_tp1 drop subpartition sp1
insert into l_rc_tp1 values (1,2,'2010-01-01','aa','bb')
insert into l_rc_tp1 values (1000,2,'2020-01-01','aa','bb')
insert into l_rc_tp1 values (2000,2,'2040-01-01','aa','bb')
insert into l_rc_tp2 values (1,2,'2010-01-01','aa','bb')
insert into l_rc_tp2 values (1,2,'2020-01-01','aa','bb')
insert into l_rc_tp2 values (1,2,'2040-01-01','aa','bb')
alter table l_rc_tp2 drop subpartition sp1
insert into l_rc_tp2 values (1000,2,'2010-01-01','aa','bb')
insert into l_rc_tp2 values (2000,2,'2020-01-01','aa','bb')
insert into l_rc_tp2 values (2000,2,'2040-01-01','aa','bb')
alter table l_rc_tp2 drop partition p1
insert into l_rc_tp2 values (1000,2,'2010-01-01','aa','bb')
insert into l_rc_tp2 values (2000,2,'2020-01-01','aa','bb')
insert into l_rc_tp2 values (3000,2,'2040-01-01','aa','bb')
show full create table l_rc_tp1
Table,Create Table
l_rc_tp1,CREATE TABLE `l_rc_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY RANGE COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE,MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_rc_tp2
Table,Create Table
l_rc_tp2,CREATE TABLE `l_rc_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY RANGE COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE,MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from l_rc_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,aa,bb
1000,2,2020-01-01 00:00:00.0,aa,bb
2000,2,2040-01-01 00:00:00.0,aa,bb
2000,2,2040-01-01 00:00:00.0,aa,bb
select * from l_rc_tp2 order by a,b,c,d,e
a,b,c,d,e
1000,2,2010-01-01 00:00:00.0,aa,bb
1000,2,2010-01-01 00:00:00.0,aa,bb
2000,2,2020-01-01 00:00:00.0,aa,bb
2000,2,2040-01-01 00:00:00.0,aa,bb
3000,2,2040-01-01 00:00:00.0,aa,bb
## l_l_tp
drop table if exists l_l_tp1
drop table if exists l_l_tp2
create table if not exists l_l_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list (a)
(
subpartition sp1 values in ( 1000, 2000),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_l_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list (a)
(
subpartition sp1 values in ( 1000, 2000),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_l_tp1 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp1 values (2000,2,'2020-01-01','aa','bb')
insert into l_l_tp1 values (3000,2,'2040-01-01','aa','bb')
alter table l_l_tp1 drop partition p1
insert into l_l_tp1 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp1 values (3000,2,'2020-01-01','aa','bb')
insert into l_l_tp1 values (5000,2,'2040-01-01','aa','bb')
alter table l_l_tp1 drop subpartition sp1
insert into l_l_tp1 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp1 values (3000,2,'2020-01-01','aa','bb')
insert into l_l_tp1 values (5000,2,'2040-01-01','aa','bb')
insert into l_l_tp2 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp2 values (2000,2,'2020-01-01','aa','bb')
insert into l_l_tp2 values (3000,2,'2040-01-01','aa','bb')
alter table l_l_tp2 drop subpartition sp1
insert into l_l_tp2 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp2 values (3000,2,'2020-01-01','aa','bb')
insert into l_l_tp2 values (5000,2,'2040-01-01','aa','bb')
alter table l_l_tp2 drop partition p1
insert into l_l_tp2 values (1000,2,'2010-01-01','aa','bb')
insert into l_l_tp2 values (3000,2,'2020-01-01','aa','bb')
insert into l_l_tp2 values (5000,2,'2040-01-01','aa','bb')
show full create table l_l_tp1
Table,Create Table
l_l_tp1,CREATE TABLE `l_l_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY LIST(`a`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_l_tp2
Table,Create Table
l_l_tp2,CREATE TABLE `l_l_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY LIST(`a`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from l_l_tp1 order by a,b,c,d,e
a,b,c,d,e
1000,2,2010-01-01 00:00:00.0,aa,bb
3000,2,2020-01-01 00:00:00.0,aa,bb
3000,2,2020-01-01 00:00:00.0,aa,bb
3000,2,2040-01-01 00:00:00.0,aa,bb
5000,2,2040-01-01 00:00:00.0,aa,bb
5000,2,2040-01-01 00:00:00.0,aa,bb
select * from l_l_tp2 order by a,b,c,d,e
a,b,c,d,e
1000,2,2010-01-01 00:00:00.0,aa,bb
1000,2,2010-01-01 00:00:00.0,aa,bb
3000,2,2020-01-01 00:00:00.0,aa,bb
3000,2,2040-01-01 00:00:00.0,aa,bb
5000,2,2040-01-01 00:00:00.0,aa,bb
5000,2,2040-01-01 00:00:00.0,aa,bb
## l_lc_tp
drop table if exists l_lc_tp1
drop table if exists l_lc_tp2
create table if not exists l_lc_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list columns (a,b)
(
subpartition sp1 values in ( (1000, 2000) ),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
create table if not exists l_lc_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list (to_days(c))
subpartition by list columns (a,b)
(
subpartition sp1 values in ( (1000, 2000) ),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( to_days('2020-01-01') ),
partition p2 values in ( default )
)
insert into l_lc_tp1 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp1 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp1 values (5000,2000,'2040-01-01','aa','bb')
alter table l_lc_tp1 drop partition p1
insert into l_lc_tp1 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp1 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp1 values (5000,2000,'2040-01-01','aa','bb')
alter table l_lc_tp1 drop subpartition sp1
insert into l_lc_tp1 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp1 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp1 values (5000,2000,'2040-01-01','aa','bb')
insert into l_lc_tp2 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp2 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp2 values (5000,2000,'2040-01-01','aa','bb')
alter table l_lc_tp2 drop subpartition sp1
insert into l_lc_tp2 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp2 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp2 values (5000,2000,'2040-01-01','aa','bb')
alter table l_lc_tp2 drop partition p1
insert into l_lc_tp2 values (1000,2000,'2010-01-01','aa','bb')
insert into l_lc_tp2 values (3000,2000,'2020-01-01','aa','bb')
insert into l_lc_tp2 values (5000,2000,'2040-01-01','aa','bb')
show full create table l_lc_tp1
Table,Create Table
l_lc_tp1,CREATE TABLE `l_lc_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY LIST COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table l_lc_tp2
Table,Create Table
l_lc_tp2,CREATE TABLE `l_lc_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c` USING BTREE (`c`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST(TO_DAYS(`c`))
SUBPARTITION BY LIST COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from l_lc_tp1 order by a,b,c,d,e
a,b,c,d,e
1000,2000,2010-01-01 00:00:00.0,aa,bb
3000,2000,2020-01-01 00:00:00.0,aa,bb
3000,2000,2020-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
select * from l_lc_tp2 order by a,b,c,d,e
a,b,c,d,e
1000,2000,2010-01-01 00:00:00.0,aa,bb
1000,2000,2010-01-01 00:00:00.0,aa,bb
3000,2000,2020-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
5000,2000,2040-01-01 00:00:00.0,aa,bb
## lc_h_tp
drop table if exists lc_h_tp1
drop table if exists lc_h_tp2
create table if not exists lc_h_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by hash (a,b) subpartitions 4
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_h_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by hash (a,b) subpartitions 4
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_h_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_h_tp1 values (2,2,'2020-01-01','abc','bb')
insert into lc_h_tp1 values (3,2,'2040-01-01','abc','bb')
alter table lc_h_tp1 drop partition p1
insert into lc_h_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_h_tp1 values (3,2,'2020-01-01','abc','bb')
insert into lc_h_tp1 values (3,2,'2040-01-01','abc','bb')
insert into lc_h_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_h_tp2 values (2,2,'2020-01-01','abc','bb')
insert into lc_h_tp2 values (3,2,'2040-01-01','abc','bb')
alter table lc_h_tp2 drop partition p1
insert into lc_h_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_h_tp2 values (2,2,'2020-01-01','abc','bb')
insert into lc_h_tp2 values (3,2,'2040-01-01','abc','bb')
show full create table lc_h_tp1
Table,Create Table
lc_h_tp1,CREATE TABLE `lc_h_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY HASH(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_h_tp2
Table,Create Table
lc_h_tp2,CREATE TABLE `lc_h_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY HASH(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from lc_h_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
3,2,2020-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_h_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
2,2,2020-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
## lc_k_tp
drop table if exists lc_k_tp1
drop table if exists lc_k_tp2
create table if not exists lc_k_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by key (a,b) subpartitions 4
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_k_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by key (a,b) subpartitions 4
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_k_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_k_tp1 values (2,2,'2020-01-01','abc','bb')
insert into lc_k_tp1 values (3,2,'2040-01-01','abc','bb')
alter table lc_k_tp1 drop partition p1
insert into lc_k_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_k_tp1 values (2,2,'2020-01-01','abc','bb')
insert into lc_k_tp1 values (3,2,'2040-01-01','abc','bb')
insert into lc_k_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_k_tp2 values (2,2,'2020-01-01','abc','bb')
insert into lc_k_tp2 values (3,2,'2040-01-01','abc','bb')
alter table lc_k_tp2 drop partition p2
insert into lc_k_tp2 values (2,2,'2020-01-01','abc','bb')
insert into lc_k_tp2 values (100,2,'2020-01-01','abc','bb')
insert into lc_k_tp2 values (300,2,'2020-01-01','abc','bb')
show full create table lc_k_tp1
Table,Create Table
lc_k_tp1,CREATE TABLE `lc_k_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY KEY(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_k_tp2
Table,Create Table
lc_k_tp2,CREATE TABLE `lc_k_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY KEY(`a`,`b`)
SUBPARTITIONS 4
(PARTITION p1 VALUES IN (('2020-01-01 00:00:00','abc')))
/* tablegroup = `tg` */
select * from lc_k_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
2,2,2020-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
3,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_k_tp2 order by a,b,c,d,e
a,b,c,d,e
2,2,2020-01-01 00:00:00.0,abc,bb
2,2,2020-01-01 00:00:00.0,abc,bb
100,2,2020-01-01 00:00:00.0,abc,bb
300,2,2020-01-01 00:00:00.0,abc,bb
## lc_r_tp
drop table if exists lc_r_tp1
drop table if exists lc_r_tp2
create table if not exists lc_r_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range (a)
(
subpartition sp1 values less than ( 1000),
subpartition sp2 values less than ( maxvalue )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_r_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range (a)
(
subpartition sp1 values less than ( 1000),
subpartition sp2 values less than ( maxvalue )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_r_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_r_tp1 drop partition p1
insert into lc_r_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_r_tp1 drop subpartition sp1
insert into lc_r_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp1 values (3000,2,'2040-01-01','abc','bb')
insert into lc_r_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp2 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_r_tp2 drop subpartition sp1
insert into lc_r_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp2 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_r_tp2 drop partition p1
insert into lc_r_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_r_tp2 values (2000,2,'2020-01-01','abc','bb')
insert into lc_r_tp2 values (3000,2,'2040-01-01','abc','bb')
show full create table lc_r_tp1
Table,Create Table
lc_r_tp1,CREATE TABLE `lc_r_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY RANGE(`a`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_r_tp2
Table,Create Table
lc_r_tp2,CREATE TABLE `lc_r_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY RANGE(`a`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from lc_r_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
2000,2,2020-01-01 00:00:00.0,abc,bb
2000,2,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_r_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
2000,2,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
## lc_rc_tp
drop table if exists lc_rc_tp1
drop table if exists lc_rc_tp2
create table if not exists lc_rc_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range columns (a,b)
(
subpartition sp1 values less than ( 1000, 10000),
subpartition sp2 values less than ( maxvalue, maxvalue )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_rc_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by range columns (a,b)
(
subpartition sp1 values less than ( 1000, 10000),
subpartition sp2 values less than ( maxvalue, maxvalue )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_rc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_rc_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_rc_tp1 drop partition p1
insert into lc_rc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_rc_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_rc_tp1 drop subpartition sp1
insert into lc_rc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp1 values (2000,2,'2020-01-01','abc','bb')
insert into lc_rc_tp1 values (3000,2,'2040-01-01','abc','bb')
insert into lc_rc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp2 values (2000,2,'2020-01-01','abc','bb')
insert into lc_rc_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_rc_tp2 drop subpartition sp2
insert into lc_rc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp2 values (100,2,'2020-01-01','abc','bb')
insert into lc_rc_tp2 values (300,2,'2040-01-01','abc','bb')
alter table lc_rc_tp2 drop partition p1
insert into lc_rc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_rc_tp2 values (100,2,'2020-01-01','abc','bb')
insert into lc_rc_tp2 values (300,2,'2040-01-01','abc','bb')
show full create table lc_rc_tp1
Table,Create Table
lc_rc_tp1,CREATE TABLE `lc_rc_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY RANGE COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES LESS THAN (MAXVALUE,MAXVALUE))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_rc_tp2
Table,Create Table
lc_rc_tp2,CREATE TABLE `lc_rc_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY RANGE COLUMNS(`a`,`b`)
(SUBPARTITION sp1 VALUES LESS THAN (1000,10000))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from lc_rc_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
2000,2,2020-01-01 00:00:00.0,abc,bb
2000,2,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_rc_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
100,2,2020-01-01 00:00:00.0,abc,bb
300,2,2040-01-01 00:00:00.0,abc,bb
300,2,2040-01-01 00:00:00.0,abc,bb
## lc_l_tp
drop table if exists lc_l_tp1
drop table if exists lc_l_tp2
create table if not exists lc_l_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list (a)
(
subpartition sp1 values in ( 1000, 2000),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_l_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list (a)
(
subpartition sp1 values in ( 1000, 2000),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_l_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_l_tp1 drop partition p1
insert into lc_l_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_l_tp1 drop subpartition sp1
insert into lc_l_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp1 values (3000,2,'2040-01-01','abc','bb')
insert into lc_l_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_l_tp2 drop subpartition sp1
insert into lc_l_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_l_tp2 drop partition p1
insert into lc_l_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_l_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_l_tp2 values (3000,2,'2040-01-01','abc','bb')
show full create table lc_l_tp1
Table,Create Table
lc_l_tp1,CREATE TABLE `lc_l_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY LIST(`a`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_l_tp2
Table,Create Table
lc_l_tp2,CREATE TABLE `lc_l_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY LIST(`a`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from lc_l_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1000,2000,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_l_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1000,2000,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
## lc_lc_tp
drop table if exists lc_lc_tp1
drop table if exists lc_lc_tp2
create table if not exists lc_lc_tp1 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list columns (a,b)
(
subpartition sp1 values in ( (1000, 2000) ),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
create table if not exists lc_lc_tp2 (
a bigint unsigned not null,
b bigint unsigned not null,
c datetime NOT NULL,
d varchar(16) NOT NULL,
e varchar(16) NOT NULL
)
partition by list columns (c,d)
subpartition by list columns (a,b)
(
subpartition sp1 values in ( (1000, 2000) ),
subpartition sp2 values in ( default )
)
(
partition p1 values in ( ('2020-01-01', 'abc') ),
partition p2 values in ( default )
)
insert into lc_lc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_lc_tp1 drop partition p1
insert into lc_lc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp1 values (3000,2,'2040-01-01','abc','bb')
alter table lc_lc_tp1 drop subpartition sp1
insert into lc_lc_tp1 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp1 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp1 values (3000,2,'2040-01-01','abc','bb')
insert into lc_lc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_lc_tp2 drop subpartition sp1
insert into lc_lc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp2 values (3000,2,'2040-01-01','abc','bb')
alter table lc_lc_tp2 drop partition p1
insert into lc_lc_tp2 values (1,2,'2010-01-01','abc','bb')
insert into lc_lc_tp2 values (1000,2000,'2020-01-01','abc','bb')
insert into lc_lc_tp2 values (3000,2,'2040-01-01','abc','bb')
show full create table lc_lc_tp1
Table,Create Table
lc_lc_tp1,CREATE TABLE `lc_lc_tp1` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY LIST COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
show full create table lc_lc_tp2
Table,Create Table
lc_lc_tp2,CREATE TABLE `lc_lc_tp2` (
	`a` bigint(20) UNSIGNED NOT NULL,
	`b` bigint(20) UNSIGNED NOT NULL,
	`c` datetime NOT NULL,
	`d` varchar(16) NOT NULL,
	`e` varchar(16) NOT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_c_d` USING BTREE (`c`, `d`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY LIST COLUMNS(`c`,`d`)
SUBPARTITION BY LIST COLUMNS(`a`,`b`)
(SUBPARTITION sp2 VALUES IN (DEFAULT))
(PARTITION p2 VALUES IN (DEFAULT))
/* tablegroup = `tg` */
select * from lc_lc_tp1 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1000,2000,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
select * from lc_lc_tp2 order by a,b,c,d,e
a,b,c,d,e
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1,2,2010-01-01 00:00:00.0,abc,bb
1000,2000,2020-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb
3000,2,2040-01-01 00:00:00.0,abc,bb