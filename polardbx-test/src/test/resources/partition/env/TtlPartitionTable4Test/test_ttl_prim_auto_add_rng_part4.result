## DISABLE_FAST_SQL_PARSER
## RESERVE_SEMICOLONS
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
set ENABLE_DROP_TRUNCATE_CCI_PARTITION =true;
create table auto_rng_part_tc4_t8(
a int not null auto_increment,
b int not null,
primary key(a)
)
partition by range columns(b)
(
partition p1 values less than(1000),
partition p2 values less than(2000),
partition p3 values less than(3000),
partition pmax values less than(maxvalue)
);
alter table auto_rng_part_tc4_t8 modify ttl set ttl_expr=`b` expire over 8 partitions, archive_type='PARTITION', ttl_part_interval=interval(1000, NUMBER);
show create table auto_rng_part_tc4_t8;
Table,Create Table
auto_rng_part_tc4_t8,CREATE TABLE `auto_rng_part_tc4_t8` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc4_t8 cleanup expired data;
show create table auto_rng_part_tc4_t8;
Table,Create Table
auto_rng_part_tc4_t8,CREATE TABLE `auto_rng_part_tc4_t8` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4000 VALUES LESS THAN (4000) ENGINE = InnoDB,
 PARTITION p5000 VALUES LESS THAN (5000) ENGINE = InnoDB,
 PARTITION p6000 VALUES LESS THAN (6000) ENGINE = InnoDB,
 PARTITION p7000 VALUES LESS THAN (7000) ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc4_t8 drop partition p1;
show create table auto_rng_part_tc4_t8;
Table,Create Table
auto_rng_part_tc4_t8,CREATE TABLE `auto_rng_part_tc4_t8` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4000 VALUES LESS THAN (4000) ENGINE = InnoDB,
 PARTITION p5000 VALUES LESS THAN (5000) ENGINE = InnoDB,
 PARTITION p6000 VALUES LESS THAN (6000) ENGINE = InnoDB,
 PARTITION p7000 VALUES LESS THAN (7000) ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc4_t8 cleanup expired data;
show create table auto_rng_part_tc4_t8;
Table,Create Table
auto_rng_part_tc4_t8,CREATE TABLE `auto_rng_part_tc4_t8` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4000 VALUES LESS THAN (4000) ENGINE = InnoDB,
 PARTITION p5000 VALUES LESS THAN (5000) ENGINE = InnoDB,
 PARTITION p6000 VALUES LESS THAN (6000) ENGINE = InnoDB,
 PARTITION p7000 VALUES LESS THAN (7000) ENGINE = InnoDB,
 PARTITION p8000 VALUES LESS THAN (8000) ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
drop table auto_rng_part_tc4_t8;
create table auto_rng_part_tc4_t9(
a int not null auto_increment,
b int not null,
primary key(a)
)
partition by key(a)
partitions 2
subpartition by range columns(b)
(
subpartition sp1 values less than(1000),
subpartition sp2 values less than(2000),
subpartition sp3 values less than(3000),
subpartition spm values less than(maxvalue)
);
alter table auto_rng_part_tc4_t9 modify ttl set ttl_expr=`b` expire over 8 partitions, archive_type='SUBPARTITION', ttl_part_interval=interval(1000, NUMBER);
show create table auto_rng_part_tc4_t9;
Table,Create Table
auto_rng_part_tc4_t9,CREATE TABLE `auto_rng_part_tc4_t9` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN (1000),
 SUBPARTITION sp2 VALUES LESS THAN (2000),
 SUBPARTITION sp3 VALUES LESS THAN (3000),
 SUBPARTITION spm VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc4_t9 cleanup expired data;
show create table auto_rng_part_tc4_t9;
Table,Create Table
auto_rng_part_tc4_t9,CREATE TABLE `auto_rng_part_tc4_t9` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN (1000),
 SUBPARTITION sp2 VALUES LESS THAN (2000),
 SUBPARTITION sp3 VALUES LESS THAN (3000),
 SUBPARTITION sp4000 VALUES LESS THAN (4000),
 SUBPARTITION sp5000 VALUES LESS THAN (5000),
 SUBPARTITION sp6000 VALUES LESS THAN (6000),
 SUBPARTITION sp7000 VALUES LESS THAN (7000),
 SUBPARTITION spm VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc4_t9 drop subpartition sp1;
show create table auto_rng_part_tc4_t9;
Table,Create Table
auto_rng_part_tc4_t9,CREATE TABLE `auto_rng_part_tc4_t9` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp2 VALUES LESS THAN (2000),
 SUBPARTITION sp3 VALUES LESS THAN (3000),
 SUBPARTITION sp4000 VALUES LESS THAN (4000),
 SUBPARTITION sp5000 VALUES LESS THAN (5000),
 SUBPARTITION sp6000 VALUES LESS THAN (6000),
 SUBPARTITION sp7000 VALUES LESS THAN (7000),
 SUBPARTITION spm VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc4_t9 cleanup expired data;
show create table auto_rng_part_tc4_t9;
Table,Create Table
auto_rng_part_tc4_t9,CREATE TABLE `auto_rng_part_tc4_t9` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` int(11) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE OVER 8 PARTITIONS , TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1000, NUMBER), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 8, ARCHIVE_TABLE_POST_ALLOCATE = 64 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp2 VALUES LESS THAN (2000),
 SUBPARTITION sp3 VALUES LESS THAN (3000),
 SUBPARTITION sp4000 VALUES LESS THAN (4000),
 SUBPARTITION sp5000 VALUES LESS THAN (5000),
 SUBPARTITION sp6000 VALUES LESS THAN (6000),
 SUBPARTITION sp7000 VALUES LESS THAN (7000),
 SUBPARTITION sp8000 VALUES LESS THAN (8000),
 SUBPARTITION spm VALUES LESS THAN (MAXVALUE))
drop table auto_rng_part_tc4_t9;