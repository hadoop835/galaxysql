## DISABLE_FAST_SQL_PARSER
## RESERVE_SEMICOLON
set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = false
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00'
create table auto_rng_part_tc3_t6(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
partition by range columns(b)
(
partition p1 values less than('2021-02-01'),
partition p2 values less than('2021-02-02'),
partition p3 values less than('2021-02-03'),
partition pmax values less than(maxvalue)
)
alter table auto_rng_part_tc3_t6 modify ttl set TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00',ARCHIVE_TABLE_PRE_ALLOCATE = 2,ARCHIVE_TABLE_POST_ALLOCATE = 2, ARCHIVE_TYPE='ROW'
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
create table auto_rng_part_tc3_t6_bk like auto_rng_part_tc3_t6 engine='columnar' archive_mode='ttl'
alter table auto_rng_part_tc3_t6 cleanup expired data
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc3_t6 modify ttl TTL_ENABLE = 'ON', TTL_CLEANUP='ON',TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE='PARTITION'
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'ON', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc3_t6 cleanup expired data
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'ON', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-06-28 00:00:00'
alter table auto_rng_part_tc3_t6 cleanup expired data
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'ON', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB,
 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
alter table auto_rng_part_tc3_t6 modify ttl TTL_ENABLE = 'ON', TTL_CLEANUP='ON',TTL_PART_INTERVAL = INTERVAL(3, DAY), ARCHIVE_TYPE='PARTITION'
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'ON', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(3, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB,
 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-07-01 00:00:00'
alter table auto_rng_part_tc3_t6 cleanup expired data
show create table auto_rng_part_tc3_t6
Table,Create Table
auto_rng_part_tc3_t6,CREATE TABLE `auto_rng_part_tc3_t6` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc3_t6_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240625 VALUES LESS THAN ('2024-06-25 00:00:00') ENGINE = Columnar,
		 PARTITION p20240626 VALUES LESS THAN ('2024-06-26 00:00:00') ENGINE = Columnar,
		 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = Columnar,
		 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = Columnar,
		 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = Columnar,
		 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240704 VALUES LESS THAN ('2024-07-04 00:00:00') ENGINE = Columnar,
		 PARTITION p20240707 VALUES LESS THAN ('2024-07-07 00:00:00') ENGINE = Columnar,
		 PARTITION p20240710 VALUES LESS THAN ('2024-07-10 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'ON', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(3, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc3_t6_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB,
 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
 PARTITION p20240704 VALUES LESS THAN ('2024-07-04 00:00:00') ENGINE = InnoDB,
 PARTITION p20240707 VALUES LESS THAN ('2024-07-07 00:00:00') ENGINE = InnoDB,
 PARTITION p20240710 VALUES LESS THAN ('2024-07-10 00:00:00') ENGINE = InnoDB,
 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = InnoDB)
/*TDDL:cmd_extra(TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI=false)*/drop table auto_rng_part_tc3_t6;