## DISABLE_FAST_SQL_PARSER
## RESERVE_SEMICOLONS
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set TTL_DEBUG_CURRENT_DATETIME='2025-01-08 00:00:00';
set TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI=false;
set ENABLE_DROP_TRUNCATE_CCI_PARTITION=true;
create table auto_rng_part_tc8_t1(
a int not null auto_increment,
b bigint not null,
primary key(a)
)
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(
SUBPARTITION sp20250104 VALUES LESS THAN (1735920000000),
SUBPARTITION sp20250105 VALUES LESS THAN (1736006400000),
SUBPARTITION sp20250106 VALUES LESS THAN (1736092800000),
SUBPARTITION sp20250107 VALUES LESS THAN (1736179200000)
);
alter table auto_rng_part_tc8_t1 modify ttl set ttl_expr= from_unixtime(`b`/ 1000) expire after 3 DAY timezone '+08:00',ttl_part_interval=interval(1,DAY),archive_type='SUBPARTITION', archive_table_post_allocate=2, archive_table_pre_allocate=5;
alter table auto_rng_part_tc8_t1 cleanup expired data;
create table auto_rng_part_tc8_t1_bk like auto_rng_part_tc8_t1 engine=columnar archive_mode='ttl';
set TTL_DEBUG_CURRENT_DATETIME='2025-01-09 00:00:00';
alter table auto_rng_part_tc8_t1 cleanup expired data;
show create table auto_rng_part_tc8_t1;
Table,Create Table
auto_rng_part_tc8_t1,CREATE TABLE `auto_rng_part_tc8_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800000) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200000) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600000) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400000) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800000) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200000) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600000) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400000) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b` / 1000) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250104 VALUES LESS THAN (1735920000000),
 SUBPARTITION sp20250105 VALUES LESS THAN (1736006400000),
 SUBPARTITION sp20250106 VALUES LESS THAN (1736092800000),
 SUBPARTITION sp20250107 VALUES LESS THAN (1736179200000),
 SUBPARTITION sp20250108 VALUES LESS THAN (1736265600000),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400000),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800000),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200000),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600000),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400000))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-10 00:00:00';
alter table auto_rng_part_tc8_t1 cleanup expired data;
show create table auto_rng_part_tc8_t1;
Table,Create Table
auto_rng_part_tc8_t1,CREATE TABLE `auto_rng_part_tc8_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800000) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200000) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600000) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400000) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800000) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200000) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600000) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400000) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800000) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b` / 1000) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250104 VALUES LESS THAN (1735920000000),
 SUBPARTITION sp20250105 VALUES LESS THAN (1736006400000),
 SUBPARTITION sp20250106 VALUES LESS THAN (1736092800000),
 SUBPARTITION sp20250107 VALUES LESS THAN (1736179200000),
 SUBPARTITION sp20250108 VALUES LESS THAN (1736265600000),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400000),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800000),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200000),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600000),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400000),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800000))
alter table auto_rng_part_tc8_t1 modify ttl set ttl_cleanup='on';
alter table auto_rng_part_tc8_t1 cleanup expired data;
show create table auto_rng_part_tc8_t1;
Table,Create Table
auto_rng_part_tc8_t1,CREATE TABLE `auto_rng_part_tc8_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800000) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200000) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600000) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400000) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800000) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200000) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600000) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400000) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800000) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b` / 1000) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250108 VALUES LESS THAN (1736265600000),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400000),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800000),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200000),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600000),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400000),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800000))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-11 00:00:00';
alter table auto_rng_part_tc8_t1 cleanup expired data;
show create table auto_rng_part_tc8_t1;
Table,Create Table
auto_rng_part_tc8_t1,CREATE TABLE `auto_rng_part_tc8_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800000) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200000) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600000) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400000) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800000) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200000) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600000) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400000) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800000) ENGINE = Columnar,
		 PARTITION p20250117 VALUES LESS THAN (1737043200000) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b` / 1000) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250109 VALUES LESS THAN (1736352000000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400000),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800000),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200000),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600000),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400000),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800000),
 SUBPARTITION sp20250117 VALUES LESS THAN (1737043200000))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-12 00:00:00';
alter table auto_rng_part_tc8_t1 cleanup expired data;
show create table auto_rng_part_tc8_t1;
Table,Create Table
auto_rng_part_tc8_t1,CREATE TABLE `auto_rng_part_tc8_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800000) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200000) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600000) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400000) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800000) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200000) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600000) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400000) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800000) ENGINE = Columnar,
		 PARTITION p20250117 VALUES LESS THAN (1737043200000) ENGINE = Columnar,
		 PARTITION p20250118 VALUES LESS THAN (1737129600000) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b` / 1000) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250110 VALUES LESS THAN (1736438400000),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800000),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200000),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600000),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400000),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800000),
 SUBPARTITION sp20250117 VALUES LESS THAN (1737043200000),
 SUBPARTITION sp20250118 VALUES LESS THAN (1737129600000))
drop table auto_rng_part_tc8_t1;
create table auto_rng_part_tc8_t2(
a int not null auto_increment,
b bigint not null,
primary key(a)
)
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(
SUBPARTITION sp20250104 VALUES LESS THAN (1735920000),
SUBPARTITION sp20250105 VALUES LESS THAN (1736006400),
SUBPARTITION sp20250106 VALUES LESS THAN (1736092800),
SUBPARTITION sp20250107 VALUES LESS THAN (1736179200)
);
alter table auto_rng_part_tc8_t2 modify ttl set ttl_expr= from_unixtime(`b`) expire after 3 DAY timezone '+08:00',ttl_part_interval=interval(1,DAY),archive_type='SUBPARTITION', archive_table_post_allocate=2, archive_table_pre_allocate=5;
set TTL_DEBUG_CURRENT_DATETIME='2025-01-08 00:00:00';
alter table auto_rng_part_tc8_t2 cleanup expired data;
create table auto_rng_part_tc8_t2_bk like auto_rng_part_tc8_t2 engine=columnar archive_mode='ttl';
set TTL_DEBUG_CURRENT_DATETIME='2025-01-09 00:00:00';
alter table auto_rng_part_tc8_t2 cleanup expired data;
show create table auto_rng_part_tc8_t2;
Table,Create Table
auto_rng_part_tc8_t2,CREATE TABLE `auto_rng_part_tc8_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250104 VALUES LESS THAN (1735920000),
 SUBPARTITION sp20250105 VALUES LESS THAN (1736006400),
 SUBPARTITION sp20250106 VALUES LESS THAN (1736092800),
 SUBPARTITION sp20250107 VALUES LESS THAN (1736179200),
 SUBPARTITION sp20250108 VALUES LESS THAN (1736265600),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-10 00:00:00';
alter table auto_rng_part_tc8_t2 cleanup expired data;
show create table auto_rng_part_tc8_t2;
Table,Create Table
auto_rng_part_tc8_t2,CREATE TABLE `auto_rng_part_tc8_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250104 VALUES LESS THAN (1735920000),
 SUBPARTITION sp20250105 VALUES LESS THAN (1736006400),
 SUBPARTITION sp20250106 VALUES LESS THAN (1736092800),
 SUBPARTITION sp20250107 VALUES LESS THAN (1736179200),
 SUBPARTITION sp20250108 VALUES LESS THAN (1736265600),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800))
alter table auto_rng_part_tc8_t2 modify ttl set ttl_cleanup='on';
alter table auto_rng_part_tc8_t2 cleanup expired data;
show create table auto_rng_part_tc8_t2;
Table,Create Table
auto_rng_part_tc8_t2,CREATE TABLE `auto_rng_part_tc8_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250108 VALUES LESS THAN (1736265600),
 SUBPARTITION sp20250109 VALUES LESS THAN (1736352000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-11 00:00:00';
alter table auto_rng_part_tc8_t2 cleanup expired data;
show create table auto_rng_part_tc8_t2;
Table,Create Table
auto_rng_part_tc8_t2,CREATE TABLE `auto_rng_part_tc8_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800) ENGINE = Columnar,
		 PARTITION p20250117 VALUES LESS THAN (1737043200) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250109 VALUES LESS THAN (1736352000),
 SUBPARTITION sp20250110 VALUES LESS THAN (1736438400),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800),
 SUBPARTITION sp20250117 VALUES LESS THAN (1737043200))
set TTL_DEBUG_CURRENT_DATETIME='2025-01-12 00:00:00';
alter table auto_rng_part_tc8_t2 cleanup expired data;
show create table auto_rng_part_tc8_t2;
Table,Create Table
auto_rng_part_tc8_t2,CREATE TABLE `auto_rng_part_tc8_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc8_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20250106 VALUES LESS THAN (1736092800) ENGINE = Columnar,
		 PARTITION p20250107 VALUES LESS THAN (1736179200) ENGINE = Columnar,
		 PARTITION p20250108 VALUES LESS THAN (1736265600) ENGINE = Columnar,
		 PARTITION p20250109 VALUES LESS THAN (1736352000) ENGINE = Columnar,
		 PARTITION p20250110 VALUES LESS THAN (1736438400) ENGINE = Columnar,
		 PARTITION p20250111 VALUES LESS THAN (1736524800) ENGINE = Columnar,
		 PARTITION p20250112 VALUES LESS THAN (1736611200) ENGINE = Columnar,
		 PARTITION p20250113 VALUES LESS THAN (1736697600) ENGINE = Columnar,
		 PARTITION p20250114 VALUES LESS THAN (1736784000) ENGINE = Columnar,
		 PARTITION p20250115 VALUES LESS THAN (1736870400) ENGINE = Columnar,
		 PARTITION p20250116 VALUES LESS THAN (1736956800) ENGINE = Columnar,
		 PARTITION p20250117 VALUES LESS THAN (1737043200) ENGINE = Columnar,
		 PARTITION p20250118 VALUES LESS THAN (1737129600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc8_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 5, ARCHIVE_TABLE_POST_ALLOCATE = 5 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp20250110 VALUES LESS THAN (1736438400),
 SUBPARTITION sp20250111 VALUES LESS THAN (1736524800),
 SUBPARTITION sp20250112 VALUES LESS THAN (1736611200),
 SUBPARTITION sp20250113 VALUES LESS THAN (1736697600),
 SUBPARTITION sp20250114 VALUES LESS THAN (1736784000),
 SUBPARTITION sp20250115 VALUES LESS THAN (1736870400),
 SUBPARTITION sp20250116 VALUES LESS THAN (1736956800),
 SUBPARTITION sp20250117 VALUES LESS THAN (1737043200),
 SUBPARTITION sp20250118 VALUES LESS THAN (1737129600))
drop table auto_rng_part_tc8_t2;