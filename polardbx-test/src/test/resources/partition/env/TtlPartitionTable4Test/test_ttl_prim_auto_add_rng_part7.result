## DISABLE_FAST_SQL_PARSER
## RESERVE_SEMICOLONS
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set TTL_DEBUG_CURRENT_DATETIME='2025-01-08 00:00:00';
set TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI=false;
set ENABLE_DROP_TRUNCATE_CCI_PARTITION=true;
create table auto_rng_part_tc7_t1(
a int not null auto_increment,
b bigint not null,
primary key(a)
)
partition by range columns(b)
(
  partition p20200202 values less than(1580572800),
  partition p20200303 values less than(1583164800),
  partition p20200404 values less than(1585929600)
);
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20200202 VALUES LESS THAN (1580572800) ENGINE = InnoDB,
 PARTITION p20200303 VALUES LESS THAN (1583164800) ENGINE = InnoDB,
 PARTITION p20200404 VALUES LESS THAN (1585929600) ENGINE = InnoDB)
alter table auto_rng_part_tc7_t1 modify ttl set ttl_expr= from_unixtime(`b`) expire after 2 MONTH timezone '+08:00',ttl_part_interval=interval(1,MONTH),archive_type='PARTITION', archive_table_post_allocate=2, archive_table_pre_allocate=3;
set TTL_DEBUG_CURRENT_DATETIME='2022-02-08 00:00:00';
alter table auto_rng_part_tc7_t1 cleanup expired data;
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20200202 VALUES LESS THAN (1580572800) ENGINE = InnoDB,
 PARTITION p20200303 VALUES LESS THAN (1583164800) ENGINE = InnoDB,
 PARTITION p20200404 VALUES LESS THAN (1585929600) ENGINE = InnoDB,
 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = InnoDB,
 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = InnoDB,
 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2022-03-08 00:00:00';
alter table auto_rng_part_tc7_t1 cleanup expired data;
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20200202 VALUES LESS THAN (1580572800) ENGINE = InnoDB,
 PARTITION p20200303 VALUES LESS THAN (1583164800) ENGINE = InnoDB,
 PARTITION p20200404 VALUES LESS THAN (1585929600) ENGINE = InnoDB,
 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = InnoDB,
 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = InnoDB,
 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB)
create table auto_rng_part_tc7_t1_bk like auto_rng_part_tc7_t1 engine=columnar archive_mode='ttl';
alter table auto_rng_part_tc7_t1 modify ttl set ttl_cleanup='on';
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220101 VALUES LESS THAN (1640966400) ENGINE = Columnar,
		 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = Columnar,
		 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = Columnar,
		 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20200202 VALUES LESS THAN (1580572800) ENGINE = InnoDB,
 PARTITION p20200303 VALUES LESS THAN (1583164800) ENGINE = InnoDB,
 PARTITION p20200404 VALUES LESS THAN (1585929600) ENGINE = InnoDB,
 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = InnoDB,
 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = InnoDB,
 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2022-04-08 00:00:00';
alter table auto_rng_part_tc7_t1 cleanup expired data;
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220101 VALUES LESS THAN (1640966400) ENGINE = Columnar,
		 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = Columnar,
		 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = Columnar,
		 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = InnoDB,
 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB,
 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2022-05-08 00:00:00';
alter table auto_rng_part_tc7_t1 cleanup expired data;
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220101 VALUES LESS THAN (1640966400) ENGINE = Columnar,
		 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = Columnar,
		 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = Columnar,
		 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB,
 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = InnoDB,
 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = InnoDB)
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220101 VALUES LESS THAN (1640966400) ENGINE = Columnar,
		 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = Columnar,
		 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = Columnar,
		 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB,
 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = InnoDB,
 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = InnoDB)
alter table auto_rng_part_tc7_t1 cleanup expired data;
show create table auto_rng_part_tc7_t1;
Table,Create Table
auto_rng_part_tc7_t1,CREATE TABLE `auto_rng_part_tc7_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t1_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220101 VALUES LESS THAN (1640966400) ENGINE = Columnar,
		 PARTITION p20220201 VALUES LESS THAN (1643644800) ENGINE = Columnar,
		 PARTITION p20220301 VALUES LESS THAN (1646064000) ENGINE = Columnar,
		 PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t1_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20220401 VALUES LESS THAN (1648742400) ENGINE = InnoDB,
 PARTITION p20220501 VALUES LESS THAN (1651334400) ENGINE = InnoDB,
 PARTITION p20220601 VALUES LESS THAN (1654012800) ENGINE = InnoDB,
 PARTITION p20220701 VALUES LESS THAN (1656604800) ENGINE = InnoDB,
 PARTITION p20220801 VALUES LESS THAN (1659283200) ENGINE = InnoDB,
 PARTITION p20220901 VALUES LESS THAN (1661961600) ENGINE = InnoDB)
drop table auto_rng_part_tc7_t1;
## timezone_on_utc
create table auto_rng_part_tc7_t2(
a int not null auto_increment,
b bigint not null,
primary key(a)
)
partition by range columns(b)
(
partition p20240401 values less than(1711929600),
partition p20240501 values less than(1714521600),
partition p20240601 values less than(1717200000)
);
alter table auto_rng_part_tc7_t2 modify ttl set ttl_expr= from_unixtime(`b`) expire after 3 MONTH timezone '+00:00',ttl_part_interval=interval(1,MONTH),archive_type='PARTITION', ttl_cleanup='on', archive_table_post_allocate=1, archive_table_pre_allocate=3;
create table auto_rng_part_tc7_t2_bk like auto_rng_part_tc7_t2 engine=columnar archive_mode='ttl';
set TTL_DEBUG_CURRENT_DATETIME='2024-01-08 00:00:00';
alter table auto_rng_part_tc7_t2 cleanup expired data;
show create table auto_rng_part_tc7_t2;
Table,Create Table
auto_rng_part_tc7_t2,CREATE TABLE `auto_rng_part_tc7_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220401 VALUES LESS THAN (1648771200) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651363200) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654041600) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656633600) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659312000) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661990400) ENGINE = Columnar,
		 PARTITION p20240101 VALUES LESS THAN (1704067200) ENGINE = Columnar,
		 PARTITION p20240201 VALUES LESS THAN (1706745600) ENGINE = Columnar,
		 PARTITION p20240301 VALUES LESS THAN (1709251200) ENGINE = Columnar,
		 PARTITION p20240401 VALUES LESS THAN (1711929600) ENGINE = Columnar,
		 PARTITION p20240501 VALUES LESS THAN (1714521600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20240401 VALUES LESS THAN (1711929600) ENGINE = InnoDB,
 PARTITION p20240501 VALUES LESS THAN (1714521600) ENGINE = InnoDB,
 PARTITION p20240601 VALUES LESS THAN (1717200000) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-09-08 00:00:00';
alter table auto_rng_part_tc7_t2 cleanup expired data;
show create table auto_rng_part_tc7_t2;
Table,Create Table
auto_rng_part_tc7_t2,CREATE TABLE `auto_rng_part_tc7_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220401 VALUES LESS THAN (1648771200) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651363200) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654041600) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656633600) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659312000) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661990400) ENGINE = Columnar,
		 PARTITION p20240101 VALUES LESS THAN (1704067200) ENGINE = Columnar,
		 PARTITION p20240201 VALUES LESS THAN (1706745600) ENGINE = Columnar,
		 PARTITION p20240301 VALUES LESS THAN (1709251200) ENGINE = Columnar,
		 PARTITION p20240401 VALUES LESS THAN (1711929600) ENGINE = Columnar,
		 PARTITION p20240501 VALUES LESS THAN (1714521600) ENGINE = Columnar,
		 PARTITION p20240901 VALUES LESS THAN (1725148800) ENGINE = Columnar,
		 PARTITION p20241001 VALUES LESS THAN (1727740800) ENGINE = Columnar,
		 PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = Columnar,
		 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = Columnar,
		 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20240401 VALUES LESS THAN (1711929600) ENGINE = InnoDB,
 PARTITION p20240501 VALUES LESS THAN (1714521600) ENGINE = InnoDB,
 PARTITION p20240601 VALUES LESS THAN (1717200000) ENGINE = InnoDB,
 PARTITION p20240901 VALUES LESS THAN (1725148800) ENGINE = InnoDB,
 PARTITION p20241001 VALUES LESS THAN (1727740800) ENGINE = InnoDB,
 PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = InnoDB,
 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = InnoDB,
 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-12-08 00:00:00';
alter table auto_rng_part_tc7_t2 cleanup expired data;
show create table auto_rng_part_tc7_t2;
Table,Create Table
auto_rng_part_tc7_t2,CREATE TABLE `auto_rng_part_tc7_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t2_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20220401 VALUES LESS THAN (1648771200) ENGINE = Columnar,
		 PARTITION p20220501 VALUES LESS THAN (1651363200) ENGINE = Columnar,
		 PARTITION p20220601 VALUES LESS THAN (1654041600) ENGINE = Columnar,
		 PARTITION p20220701 VALUES LESS THAN (1656633600) ENGINE = Columnar,
		 PARTITION p20220801 VALUES LESS THAN (1659312000) ENGINE = Columnar,
		 PARTITION p20220901 VALUES LESS THAN (1661990400) ENGINE = Columnar,
		 PARTITION p20240101 VALUES LESS THAN (1704067200) ENGINE = Columnar,
		 PARTITION p20240201 VALUES LESS THAN (1706745600) ENGINE = Columnar,
		 PARTITION p20240301 VALUES LESS THAN (1709251200) ENGINE = Columnar,
		 PARTITION p20240401 VALUES LESS THAN (1711929600) ENGINE = Columnar,
		 PARTITION p20240501 VALUES LESS THAN (1714521600) ENGINE = Columnar,
		 PARTITION p20240901 VALUES LESS THAN (1725148800) ENGINE = Columnar,
		 PARTITION p20241001 VALUES LESS THAN (1727740800) ENGINE = Columnar,
		 PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = Columnar,
		 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = Columnar,
		 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = Columnar,
		 PARTITION p20250201 VALUES LESS THAN (1738368000) ENGINE = Columnar,
		 PARTITION p20250301 VALUES LESS THAN (1740787200) ENGINE = Columnar,
		 PARTITION p20250401 VALUES LESS THAN (1743465600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t2_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p20241001 VALUES LESS THAN (1727740800) ENGINE = InnoDB,
 PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = InnoDB,
 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = InnoDB,
 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = InnoDB,
 PARTITION p20250201 VALUES LESS THAN (1738368000) ENGINE = InnoDB,
 PARTITION p20250301 VALUES LESS THAN (1740787200) ENGINE = InnoDB,
 PARTITION p20250401 VALUES LESS THAN (1743465600) ENGINE = InnoDB)
drop table auto_rng_part_tc7_t2;
## timezone_on_utc
create table auto_rng_part_tc7_t3(
a int not null auto_increment,
b bigint not null,
primary key(a)
)
partition by key(a)
partitions 4;
insert into auto_rng_part_tc7_t3(a,b) values (1, 1704067200);
insert into auto_rng_part_tc7_t3(a,b) values (2, 1717200000);
alter table auto_rng_part_tc7_t3 modify ttl set ttl_expr= from_unixtime(`b`) expire after 3 MONTH timezone '+00:00',ttl_part_interval=interval(1,MONTH),archive_type='ROW', ttl_cleanup='on', archive_table_post_allocate=1, archive_table_pre_allocate=3;
create table auto_rng_part_tc7_t3_bk like auto_rng_part_tc7_t3 engine=columnar archive_mode='ttl';
set TTL_DEBUG_CURRENT_DATETIME='2024-05-08 00:00:00';
alter table auto_rng_part_tc7_t3 cleanup expired data;
show create table auto_rng_part_tc7_t3;
Table,Create Table
auto_rng_part_tc7_t3,CREATE TABLE `auto_rng_part_tc7_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t3_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = Columnar,
		 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = Columnar,
		 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = Columnar,
		 PARTITION p20250201 VALUES LESS THAN (1738368000) ENGINE = Columnar,
		 PARTITION p20250301 VALUES LESS THAN (1740787200) ENGINE = Columnar,
		 PARTITION p20250401 VALUES LESS THAN (1743465600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB AUTO_INCREMENT = 3 DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t3_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 4
select * from auto_rng_part_tc7_t3 order by b;
a,b
2,1717200000
set TTL_DEBUG_CURRENT_DATETIME='2024-09-08 00:00:00';
alter table auto_rng_part_tc7_t3 cleanup expired data;
show create table auto_rng_part_tc7_t3;
Table,Create Table
auto_rng_part_tc7_t3,CREATE TABLE `auto_rng_part_tc7_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t3_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = Columnar,
		 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = Columnar,
		 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = Columnar,
		 PARTITION p20250201 VALUES LESS THAN (1738368000) ENGINE = Columnar,
		 PARTITION p20250301 VALUES LESS THAN (1740787200) ENGINE = Columnar,
		 PARTITION p20250401 VALUES LESS THAN (1743465600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB AUTO_INCREMENT = 3 DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t3_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 4
set TTL_DEBUG_CURRENT_DATETIME='2024-12-08 00:00:00';
alter table auto_rng_part_tc7_t3 cleanup expired data;
show create table auto_rng_part_tc7_t3;
Table,Create Table
auto_rng_part_tc7_t3,CREATE TABLE `auto_rng_part_tc7_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` bigint(20) NOT NULL,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_auto_rng_part_tc7_t3_bk` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20241101 VALUES LESS THAN (1730419200) ENGINE = Columnar,
		 PARTITION p20241201 VALUES LESS THAN (1733011200) ENGINE = Columnar,
		 PARTITION p20250101 VALUES LESS THAN (1735689600) ENGINE = Columnar,
		 PARTITION p20250201 VALUES LESS THAN (1738368000) ENGINE = Columnar,
		 PARTITION p20250301 VALUES LESS THAN (1740787200) ENGINE = Columnar,
		 PARTITION p20250401 VALUES LESS THAN (1743465600) ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB AUTO_INCREMENT = 3 DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = FROM_UNIXTIME(`b`) EXPIRE AFTER 3 MONTH TIMEZONE '+00:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'auto_rng_part_tc7_t3_bk', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 4
drop table auto_rng_part_tc7_t3;