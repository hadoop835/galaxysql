## DISABLE_FAST_SQL_PARSER
## RESERVE_SEMICOLONS
set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = false;
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
create table auto_rng_part_tc2_t1(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
ttl = ttl_definition(
  TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00',
  ARCHIVE_TYPE = 'PARTITION',
  ARCHIVE_TABLE_PRE_ALLOCATE = 2,
  ARCHIVE_TABLE_POST_ALLOCATE = 2 )
partition by range columns(b)
(
  partition p1 values less than('2021-02-01'),
  partition p2 values less than('2021-02-02'),
  partition p3 values less than('2021-02-03')
);
show create table auto_rng_part_tc2_t1;
Table,Create Table
auto_rng_part_tc2_t1,CREATE TABLE `auto_rng_part_tc2_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB)
alter table auto_rng_part_tc2_t1 cleanup expired data;
show create table auto_rng_part_tc2_t1;
Table,Create Table
auto_rng_part_tc2_t1,CREATE TABLE `auto_rng_part_tc2_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-07-27 00:00:00';
alter table auto_rng_part_tc2_t1 cleanup expired data;
show create table auto_rng_part_tc2_t1;
Table,Create Table
auto_rng_part_tc2_t1,CREATE TABLE `auto_rng_part_tc2_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'PARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION p1 VALUES LESS THAN ('2021-02-01 00:00:00') ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN ('2021-02-02 00:00:00') ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN ('2021-02-03 00:00:00') ENGINE = InnoDB,
 PARTITION p20240627 VALUES LESS THAN ('2024-06-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240628 VALUES LESS THAN ('2024-06-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240629 VALUES LESS THAN ('2024-06-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240630 VALUES LESS THAN ('2024-06-30 00:00:00') ENGINE = InnoDB,
 PARTITION p20240727 VALUES LESS THAN ('2024-07-27 00:00:00') ENGINE = InnoDB,
 PARTITION p20240728 VALUES LESS THAN ('2024-07-28 00:00:00') ENGINE = InnoDB,
 PARTITION p20240729 VALUES LESS THAN ('2024-07-29 00:00:00') ENGINE = InnoDB,
 PARTITION p20240730 VALUES LESS THAN ('2024-07-30 00:00:00') ENGINE = InnoDB)
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
create table auto_rng_part_tc2_t2(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
ttl = ttl_definition(
TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00',
ARCHIVE_TYPE = 'SUBPARTITION',
ARCHIVE_TABLE_PRE_ALLOCATE = 2,
ARCHIVE_TABLE_POST_ALLOCATE = 2 )
partition by key(a)
partitions 2
subpartition by range columns(b)
(
subpartition sp1 values less than('2021-02-01'),
subpartition sp2 values less than('2021-02-02'),
subpartition sp3 values less than('2021-02-03'),
subpartition spmax values less than(maxvalue)
);
show create table auto_rng_part_tc2_t2;
Table,Create Table
auto_rng_part_tc2_t2,CREATE TABLE `auto_rng_part_tc2_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN ('2021-02-01 00:00:00'),
 SUBPARTITION sp2 VALUES LESS THAN ('2021-02-02 00:00:00'),
 SUBPARTITION sp3 VALUES LESS THAN ('2021-02-03 00:00:00'),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t2 cleanup expired data;
show create table auto_rng_part_tc2_t2;
Table,Create Table
auto_rng_part_tc2_t2,CREATE TABLE `auto_rng_part_tc2_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN ('2021-02-01 00:00:00'),
 SUBPARTITION sp2 VALUES LESS THAN ('2021-02-02 00:00:00'),
 SUBPARTITION sp3 VALUES LESS THAN ('2021-02-03 00:00:00'),
 SUBPARTITION sp20240627 VALUES LESS THAN ('2024-06-27 00:00:00'),
 SUBPARTITION sp20240628 VALUES LESS THAN ('2024-06-28 00:00:00'),
 SUBPARTITION sp20240629 VALUES LESS THAN ('2024-06-29 00:00:00'),
 SUBPARTITION sp20240630 VALUES LESS THAN ('2024-06-30 00:00:00'),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-28 00:00:00';
alter table auto_rng_part_tc2_t2 cleanup expired data;
show create table auto_rng_part_tc2_t2;
Table,Create Table
auto_rng_part_tc2_t2,CREATE TABLE `auto_rng_part_tc2_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN ('2021-02-01 00:00:00'),
 SUBPARTITION sp2 VALUES LESS THAN ('2021-02-02 00:00:00'),
 SUBPARTITION sp3 VALUES LESS THAN ('2021-02-03 00:00:00'),
 SUBPARTITION sp20240627 VALUES LESS THAN ('2024-06-27 00:00:00'),
 SUBPARTITION sp20240628 VALUES LESS THAN ('2024-06-28 00:00:00'),
 SUBPARTITION sp20240629 VALUES LESS THAN ('2024-06-29 00:00:00'),
 SUBPARTITION sp20240630 VALUES LESS THAN ('2024-06-30 00:00:00'),
 SUBPARTITION sp20240701 VALUES LESS THAN ('2024-07-01 00:00:00'),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-29 00:00:00';
alter table auto_rng_part_tc2_t2 cleanup expired data;
show create table auto_rng_part_tc2_t2;
Table,Create Table
auto_rng_part_tc2_t2,CREATE TABLE `auto_rng_part_tc2_t2` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE COLUMNS(`b`)
(SUBPARTITION sp1 VALUES LESS THAN ('2021-02-01 00:00:00'),
 SUBPARTITION sp2 VALUES LESS THAN ('2021-02-02 00:00:00'),
 SUBPARTITION sp3 VALUES LESS THAN ('2021-02-03 00:00:00'),
 SUBPARTITION sp20240627 VALUES LESS THAN ('2024-06-27 00:00:00'),
 SUBPARTITION sp20240628 VALUES LESS THAN ('2024-06-28 00:00:00'),
 SUBPARTITION sp20240629 VALUES LESS THAN ('2024-06-29 00:00:00'),
 SUBPARTITION sp20240630 VALUES LESS THAN ('2024-06-30 00:00:00'),
 SUBPARTITION sp20240701 VALUES LESS THAN ('2024-07-01 00:00:00'),
 SUBPARTITION sp20240702 VALUES LESS THAN ('2024-07-02 00:00:00'),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
create table auto_rng_part_tc2_t3(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
ttl = ttl_definition(
TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00',
ARCHIVE_TYPE = 'SUBPARTITION',
ARCHIVE_TABLE_PRE_ALLOCATE = 2,
ARCHIVE_TABLE_POST_ALLOCATE = 2 )
partition by key(a)
partitions 2
subpartition by range(to_days(b))
(
subpartition sp1 values less than(to_days('2021-02-01')),
subpartition sp2 values less than(to_days('2021-02-02')),
subpartition sp3 values less than(to_days('2021-02-03')),
subpartition spmax values less than(maxvalue)
);
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (738187),
 SUBPARTITION sp2 VALUES LESS THAN (738188),
 SUBPARTITION sp3 VALUES LESS THAN (738189),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t3 cleanup expired data;
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (738187),
 SUBPARTITION sp2 VALUES LESS THAN (738188),
 SUBPARTITION sp3 VALUES LESS THAN (738189),
 SUBPARTITION sp20240627 VALUES LESS THAN (739429),
 SUBPARTITION sp20240628 VALUES LESS THAN (739430),
 SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-28 00:00:00';
alter table auto_rng_part_tc2_t3 cleanup expired data;
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (738187),
 SUBPARTITION sp2 VALUES LESS THAN (738188),
 SUBPARTITION sp3 VALUES LESS THAN (738189),
 SUBPARTITION sp20240627 VALUES LESS THAN (739429),
 SUBPARTITION sp20240628 VALUES LESS THAN (739430),
 SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION sp20240701 VALUES LESS THAN (739433),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-29 00:00:00';
alter table auto_rng_part_tc2_t3 cleanup expired data;
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (738187),
 SUBPARTITION sp2 VALUES LESS THAN (738188),
 SUBPARTITION sp3 VALUES LESS THAN (738189),
 SUBPARTITION sp20240627 VALUES LESS THAN (739429),
 SUBPARTITION sp20240628 VALUES LESS THAN (739430),
 SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION sp20240701 VALUES LESS THAN (739433),
 SUBPARTITION sp20240702 VALUES LESS THAN (739434),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t3 modify ttl set ttl_cleanup='on';
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (738187),
 SUBPARTITION sp2 VALUES LESS THAN (738188),
 SUBPARTITION sp3 VALUES LESS THAN (738189),
 SUBPARTITION sp20240627 VALUES LESS THAN (739429),
 SUBPARTITION sp20240628 VALUES LESS THAN (739430),
 SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION sp20240701 VALUES LESS THAN (739433),
 SUBPARTITION sp20240702 VALUES LESS THAN (739434),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t3 cleanup expired data;
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp20240628 VALUES LESS THAN (739430),
 SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION sp20240701 VALUES LESS THAN (739433),
 SUBPARTITION sp20240702 VALUES LESS THAN (739434),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-30 00:00:00';
alter table auto_rng_part_tc2_t3 cleanup expired data;
show create table auto_rng_part_tc2_t3;
Table,Create Table
auto_rng_part_tc2_t3,CREATE TABLE `auto_rng_part_tc2_t3` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(TO_DAYS(`b`))
(SUBPARTITION sp20240629 VALUES LESS THAN (739431),
 SUBPARTITION sp20240630 VALUES LESS THAN (739432),
 SUBPARTITION sp20240701 VALUES LESS THAN (739433),
 SUBPARTITION sp20240702 VALUES LESS THAN (739434),
 SUBPARTITION sp20240703 VALUES LESS THAN (739435),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
create table auto_rng_part_tc2_t4(
a int not null auto_increment,
b timestamp default current_timestamp,
primary key(a)
)
ttl = ttl_definition(
TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00',
ARCHIVE_TYPE = 'SUBPARTITION',
ARCHIVE_TABLE_PRE_ALLOCATE = 2,
ARCHIVE_TABLE_POST_ALLOCATE = 2 )
partition by key(a)
partitions 2
subpartition by range(unix_timestamp(b))
(
subpartition sp1 values less than(unix_timestamp('2021-02-01 00:00:00')),
subpartition sp2 values less than(unix_timestamp('2021-02-02 00:00:00')),
subpartition sp3 values less than(unix_timestamp('2021-02-03 00:00:00')),
subpartition spmax values less than(maxvalue)
);
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (1612108800),
 SUBPARTITION sp2 VALUES LESS THAN (1612195200),
 SUBPARTITION sp3 VALUES LESS THAN (1612281600),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t4 cleanup expired data;
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (1612108800),
 SUBPARTITION sp2 VALUES LESS THAN (1612195200),
 SUBPARTITION sp3 VALUES LESS THAN (1612281600),
 SUBPARTITION sp20240627 VALUES LESS THAN (1719417600),
 SUBPARTITION sp20240628 VALUES LESS THAN (1719504000),
 SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-28 00:00:00';
alter table auto_rng_part_tc2_t4 cleanup expired data;
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (1612108800),
 SUBPARTITION sp2 VALUES LESS THAN (1612195200),
 SUBPARTITION sp3 VALUES LESS THAN (1612281600),
 SUBPARTITION sp20240627 VALUES LESS THAN (1719417600),
 SUBPARTITION sp20240628 VALUES LESS THAN (1719504000),
 SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION sp20240701 VALUES LESS THAN (1719763200),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-29 00:00:00';
alter table auto_rng_part_tc2_t4 cleanup expired data;
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (1612108800),
 SUBPARTITION sp2 VALUES LESS THAN (1612195200),
 SUBPARTITION sp3 VALUES LESS THAN (1612281600),
 SUBPARTITION sp20240627 VALUES LESS THAN (1719417600),
 SUBPARTITION sp20240628 VALUES LESS THAN (1719504000),
 SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION sp20240701 VALUES LESS THAN (1719763200),
 SUBPARTITION sp20240702 VALUES LESS THAN (1719849600),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t4 modify ttl set ttl_cleanup='on';
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp1 VALUES LESS THAN (1612108800),
 SUBPARTITION sp2 VALUES LESS THAN (1612195200),
 SUBPARTITION sp3 VALUES LESS THAN (1612281600),
 SUBPARTITION sp20240627 VALUES LESS THAN (1719417600),
 SUBPARTITION sp20240628 VALUES LESS THAN (1719504000),
 SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION sp20240701 VALUES LESS THAN (1719763200),
 SUBPARTITION sp20240702 VALUES LESS THAN (1719849600),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
alter table auto_rng_part_tc2_t4 cleanup expired data;
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp20240628 VALUES LESS THAN (1719504000),
 SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION sp20240701 VALUES LESS THAN (1719763200),
 SUBPARTITION sp20240702 VALUES LESS THAN (1719849600),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
set TTL_DEBUG_CURRENT_DATETIME='2024-06-30 00:00:00';
alter table auto_rng_part_tc2_t4 cleanup expired data;
show create table auto_rng_part_tc2_t4;
Table,Create Table
auto_rng_part_tc2_t4,CREATE TABLE `auto_rng_part_tc2_t4` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	KEY `auto_shard_key_b` USING BTREE (`b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 DAY TIMEZONE '+08:00', TTL_JOB = CRON '0 0 2 * * ? *', TTL_CLEANUP = 'ON', TTL_PART_INTERVAL = INTERVAL(1, DAY), ARCHIVE_TYPE = 'SUBPARTITION', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 2 )
PARTITION BY KEY(`a`)
PARTITIONS 2
SUBPARTITION BY RANGE(UNIX_TIMESTAMP(`b`))
(SUBPARTITION sp20240629 VALUES LESS THAN (1719590400),
 SUBPARTITION sp20240630 VALUES LESS THAN (1719676800),
 SUBPARTITION sp20240701 VALUES LESS THAN (1719763200),
 SUBPARTITION sp20240702 VALUES LESS THAN (1719849600),
 SUBPARTITION sp20240703 VALUES LESS THAN (1719936000),
 SUBPARTITION spmax VALUES LESS THAN (MAXVALUE))
drop table auto_rng_part_tc2_t1;
drop table auto_rng_part_tc2_t2;
drop table auto_rng_part_tc2_t3;
drop table auto_rng_part_tc2_t4;